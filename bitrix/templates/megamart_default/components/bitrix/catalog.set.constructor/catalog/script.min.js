BX.namespace("BX.Catalog.SetConstructor"),BX.Catalog.SetConstructor=function(){var t=function(t){this.numSliderItems=t.numSliderItems||0,this.numSetItems=t.numSetItems||0,this.jsId=t.jsId||"",this.ajaxPath=t.ajaxPath||"",this.currency=t.currency||"",this.lid=t.lid||"",this.iblockId=t.iblockId||"",this.basketUrl=t.basketUrl||"",this.setIds=t.setIds||null,this.offersCartProps=t.offersCartProps||null,this.itemsRatio=t.itemsRatio||null,this.noFotoSrc=t.noFotoSrc||"",this.messages=t.messages,this.canBuy=t.canBuy,this.mainElementPrice=t.mainElementPrice||0,this.mainElementOldPrice=t.mainElementOldPrice||0,this.mainElementDiffPrice=t.mainElementDiffPrice||0,this.mainElementBasketQuantity=t.mainElementBasketQuantity||1,this.parentCont=BX(t.parentContId)||null,this.sliderParentCont=this.parentCont.querySelector("[data-role='slider-parent-container']"),this.sliderCont=this.parentCont.querySelector("[data-role='slider-container']"),this.sliderItemsCont=this.parentCont.querySelector("[data-role='set-other-items']"),this.setItemsCont=this.parentCont.querySelector("[data-role='set-items']"),this.setPriceCont=this.parentCont.querySelector("[data-role='set-price']"),this.setOldPriceCont=this.parentCont.querySelector("[data-role='set-old-price']"),this.setOldPriceRow=this.setOldPriceCont.parentNode,this.notAvailProduct=this.sliderItemsCont.querySelector("[data-not-avail='yes']"),this.emptySetMessage=this.parentCont.querySelector("[data-set-message='empty-set']"),BX.bindDelegate(this.setItemsCont,"click",{attribute:"data-role"},BX.proxy(this.deleteFromSet,this)),BX.bindDelegate(this.sliderItemsCont,"click",{attribute:"data-role"},BX.proxy(this.addToSet,this));var e=this.parentCont.querySelector("[data-role='set-buy-btn']");this.canBuy?(BX.show(e),BX.bind(e,"click",BX.proxy(this.addToBasket,this))):BX.hide(e),this.generateSliderStyles()};return t.prototype.generateSliderStyles=function(){var t=BX.create("style",{html:".catalog-set-constructor-slider-slide-"+this.jsId+"{width: "+60*this.numSliderItems+"%;}.catalog-set-constructor-slider-item-container-"+this.jsId+"{width: "+100/this.numSliderItems+"%;}@media (min-width:576px){.catalog-set-constructor-slider-slide-"+this.jsId+"{width: "+40*this.numSliderItems+"%;}}@media (min-width:768px){.catalog-set-constructor-slider-slide-"+this.jsId+"{width: "+25*this.numSliderItems+"%;}}",attrs:{id:"bx-set-const-style-"+this.jsId}});BX("bx-set-const-style-"+this.jsId)&&BX.remove(BX("bx-set-const-style-"+this.jsId)),this.parentCont.appendChild(t)},t.prototype.deleteFromSet=function(){var t,e,a,s,r,i,c,d,n,l,o,m,h,u,p,g=BX.proxy_context;if(g&&g.hasAttribute("data-role")&&"set-delete-btn"==g.getAttribute("data-role")){for(e=(t=BX.findParent(g,{className:"catalog-set-constructor-item"})).getAttribute("data-id"),a=t.getAttribute("data-name"),s=t.getAttribute("data-url"),r=t.getAttribute("data-img"),i=t.getAttribute("data-print-price"),c=t.getAttribute("data-price"),d=t.getAttribute("data-print-old-price"),n=t.getAttribute("data-old-price"),l=t.getAttribute("data-diff-price"),o=t.getAttribute("data-measure"),m=t.getAttribute("data-quantity"),p=BX.create("div",{attrs:{className:"catalog-set-constructor-slider-item-container catalog-set-constructor-slider-item-container-"+this.jsId,"data-id":e,"data-img":r||"","data-url":s,"data-name":a,"data-print-price":i,"data-print-old-price":d,"data-price":c,"data-old-price":n,"data-diff-price":l,"data-measure":o,"data-quantity":m},children:[BX.create("div",{attrs:{className:"catalog-set-constructor-slider-item"},children:[BX.create("a",{attrs:{className:"catalog-set-constructor-slider-item-img",href:s,target:"_blank"},children:[BX.create("div",{attrs:{className:"catalog-set-constructor-slider-item-img-container"},children:[BX.create("img",{attrs:{src:r||this.noFotoSrc,className:"img-responsive"}})]})]}),BX.create("div",{attrs:{className:"catalog-set-constructor-slider-item-title"},children:[BX.create("a",{attrs:{href:s,target:"_blank"},html:a})]}),BX.create("div",{attrs:{className:"catalog-set-constructor-slider-item-price"},children:[BX.create("div",{attrs:{className:"catalog-set-constructor-product-old-price"},html:c!=n?d:""}),BX.create("div",{attrs:{className:"catalog-set-constructor-product-new-price"},html:i+" * "+m+o})]}),BX.create("div",{attrs:{className:"catalog-set-constructor-slider-item-add-btn"},children:[BX.create("a",{attrs:{className:"btn btn-primary btn-rounded","data-role":"set-add-btn",href:"javascript:void(0)"},html:this.messages.ADD_BUTTON})]})]})]}),this.notAvailProduct?this.sliderItemsCont.insertBefore(p,this.notAvailProduct):this.sliderItemsCont.appendChild(p),this.numSliderItems++,this.numSetItems--,this.generateSliderStyles(),BX.remove(t),h=0,u=this.setIds.length;h<u;h++)this.setIds[h]==e&&this.setIds.splice(h,1);this.recountPrice(),this.numSetItems<=0&&this.emptySetMessage&&BX.adjust(this.emptySetMessage,{style:{display:"inline-block"},html:this.messages.EMPTY_SET}),this.numSliderItems>0&&this.sliderParentCont&&(this.sliderParentCont.style.display="")}},t.prototype.addToSet=function(){var t,e,a,s,r,i,c,d,n,l,o,m,h,u=BX.proxy_context;u&&u.hasAttribute("data-role")&&"set-add-btn"==u.getAttribute("data-role")&&(e=(t=u.parentNode.parentNode.parentNode).getAttribute("data-id"),a=t.getAttribute("data-name"),s=t.getAttribute("data-url"),r=t.getAttribute("data-img"),i=t.getAttribute("data-print-price"),c=t.getAttribute("data-price"),d=t.getAttribute("data-print-old-price"),n=t.getAttribute("data-old-price"),l=t.getAttribute("data-diff-price"),o=t.getAttribute("data-measure"),m=t.getAttribute("data-quantity"),h=BX.create("div",{attrs:{className:"catalog-set-constructor-item product-cat-table-card","data-id":e,"data-img":r||"","data-url":s,"data-name":a,"data-print-price":i,"data-print-old-price":d,"data-price":c,"data-old-price":n,"data-diff-price":l,"data-measure":o,"data-quantity":m,"data-role":"set-item"},children:[BX.create("div",{attrs:{className:"product-cat-container"},children:[BX.create("div",{attrs:{className:"product-cat"},children:[BX.create("div",{attrs:{className:"row align-items-center"},children:[BX.create("div",{attrs:{className:"col-3 col-sm-2"},children:[BX.create("div",{attrs:{className:"product-cat-image-wrapper"},children:[BX.create("a",{attrs:{className:"product-cat-image-canvas",href:s,target:"_blank"},children:[BX.create("img",{attrs:{src:r||this.noFotoSrc,className:"product-cat-image"}})]})]})]}),BX.create("div",{attrs:{className:"col-9 col-sm-10"},children:[BX.create("div",{attrs:{className:"row h-100 align-items-center"},children:[BX.create("div",{attrs:{className:"col-12 col-sm"},children:[BX.create("div",{attrs:{className:"product-cat-content"},children:[BX.create("div",{attrs:{className:"product-cat-head"},children:[BX.create("h6",{children:[BX.create("a",{attrs:{href:s,target:"_blank"},html:a})]})]})]})]}),BX.create("div",{attrs:{className:"col-8 col-sm-5 col-lg-4"},children:[BX.create("div",{attrs:{className:"product-cat-price-container"},children:[BX.create("div",{attrs:{className:"product-cat-price-old"},html:c!=n?d:""}),BX.create("div",{attrs:{className:"product-cat-price-current"},html:i+" * "+m+o})]})]}),BX.create("div",{attrs:{className:"col-4 col-sm-auto text-right"},children:[BX.create("div",{attrs:{className:"catalog-set-constructor-items-list-delete-btn","data-role":"set-delete-btn"},html:'<svg class="icon-svg trash-anim-icon" data-entity="basket-item-delete" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path d="M29,13H25V12a3,3,0,0,0-3-3H18a3,3,0,0,0-3,3v1H11a1,1,0,0,0,0,2H29a1,1,0,0,0,0-2ZM17,13V12a1,1,0,0,1,1-1h4a1,1,0,0,1,1,1v1Z"/>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path d="M25,31H15a3,3,0,0,1-3-3V15a1,1,0,0,1,2,0V28a1,1,0,0,0,1,1H25a1,1,0,0,0,1-1V15a1,1,0,0,1,2,0V28A3,3,0,0,1,25,31Zm-6-6V19a1,1,0,0,0-2,0v6a1,1,0,0,0,2,0Zm4,0V19a1,1,0,0,0-2,0v6a1,1,0,0,0,2,0Z"/>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>'})]})]})]})]})]})]})]}),this.setItemsCont.appendChild(h),this.numSliderItems--,this.numSetItems++,this.generateSliderStyles(),BX.remove(t),this.setIds.push(e),this.recountPrice(),this.numSetItems>0&&this.emptySetMessage&&BX.adjust(this.emptySetMessage,{style:{display:"none"},html:""}),this.numSliderItems<=0&&this.sliderParentCont&&(this.sliderParentCont.style.display="none"))},t.prototype.recountPrice=function(){var t,e,a,s=this.mainElementPrice*this.mainElementBasketQuantity,r=this.mainElementOldPrice*this.mainElementBasketQuantity,i=this.mainElementDiffPrice*this.mainElementBasketQuantity,c=BX.findChildren(this.setItemsCont,{attribute:"data-role"},!0);if(c)for(t=0,e=c.length;t<e;t++)a=Number(c[t].getAttribute("data-quantity"))||1,s+=Number(c[t].getAttribute("data-price"))*a,r+=Number(c[t].getAttribute("data-old-price"))*a,i+=Number(c[t].getAttribute("data-diff-price"))*a;this.setPriceCont.innerHTML=BX.Currency.currencyFormat(s,this.currency,!0),Math.floor(100*i)>0?(this.setOldPriceCont.innerHTML=BX.Currency.currencyFormat(r,this.currency,!0),BX.style(this.setOldPriceRow,"display","block")):(BX.style(this.setOldPriceRow,"display","none"),this.setOldPriceCont.innerHTML="")},t.prototype.addToBasket=function(){var t=BX.proxy_context;BX.showWait(t.parentNode),BX.ajax.post(this.ajaxPath,{sessid:BX.bitrix_sessid(),action:"catalogSetAdd2Basket",set_ids:this.setIds,lid:this.lid,iblockId:this.iblockId,setOffersCartProps:this.offersCartProps,itemsRatio:this.itemsRatio},BX.proxy(function(t){BX.closeWait(),document.location.href=this.basketUrl},this))},t}();