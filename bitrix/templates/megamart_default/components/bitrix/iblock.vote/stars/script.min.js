!function(t){t.JCIblockVoteStars||(t.JCIblockVoteStars=function(t){this.progressObj=null,this.ratingObj=null,this.starsObj=null,this.progressId="",this.ratingId="",this.starsId="",this.ajaxParams={},this.siteId="",this.voteData={element:0,percent:0,count:0},this.config={readOnly:!1,alreadyVoted:!0,request:!1},BX.type.isPlainObject(t)&&(BX.type.isNotEmptyString(t.progressId)&&(this.progressId=t.progressId),BX.type.isNotEmptyString(t.ratingId)&&(this.ratingId=t.ratingId),BX.type.isNotEmptyString(t.starsId)&&(this.starsId=t.starsId),BX.type.isNotEmptyString(t.ajaxUrl)&&(this.ajaxUrl=t.ajaxUrl),BX.type.isNotEmptyString(t.checkVoteUrl)&&(this.checkVoteUrl=t.checkVoteUrl),BX.type.isPlainObject(t.ajaxParams)&&(this.ajaxParams=t.ajaxParams),BX.type.isNotEmptyString(t.siteId)&&(this.siteId=t.siteId),BX.type.isPlainObject(t.voteData)&&(BX.type.isNumber(t.voteData.element)&&(this.voteData.element=t.voteData.element),BX.type.isNumber(t.voteData.percent)&&(this.voteData.percent=this.preparePercent(t.voteData.percent)),BX.type.isNumber(t.voteData.count)&&(this.voteData.count=t.voteData.count),BX.type.isNumber(t.voteData.value)&&(this.voteData.value=t.voteData.value)),BX.type.isBoolean(t.readOnly)&&(this.config.readOnly=t.readOnly)),BX.ready(BX.proxy(this.init,this))},t.JCIblockVoteStars.prototype.init=function(){BX.type.isNotEmptyString(this.progressId)&&(this.progressObj=BX(this.progressId)),BX.type.isNotEmptyString(this.ratingId)&&(this.ratingObj=BX(this.ratingId)),BX.type.isNotEmptyString(this.starsId)&&(this.starsObj=BX(this.starsId),this.items=BX.findChildren(this.starsObj)),this.showProgress(this.voteData.percent),this.showVotes(),this.checkVote()},t.JCIblockVoteStars.prototype.checkVote=function(){this.config.readOnly||this.voteData.element<=0||BX.ajax({timeout:30,method:"POST",dataType:"json",url:this.checkVoteUrl,data:{sessid:BX.bitrix_sessid(),checkVote:"Y",vote_id:this.voteData.element,site_id:this.siteId},onsuccess:BX.proxy(this.checkVoteResult,this)})},t.JCIblockVoteStars.prototype.checkVoteResult=function(t){if(BX.type.isPlainObject(t)&&t.success&&(this.config.alreadyVoted=t.voted),!(this.config.readOnly||this.config.alreadyVoted||this.voteData.element<=0)&&BX.type.isElementNode(this.starsObj)&&this.items.length)for(var s in this.items)BX.bind(this.items[s],"mouseover",BX.proxy(this.onMouseover,this)),BX.bind(this.items[s],"mouseout",BX.proxy(this.onMouseout,this)),BX.bind(this.items[s],"click",BX.proxy(this.handlerClick,this))},t.JCIblockVoteStars.prototype.destroy=function(){if(this.starsObj=null,this.items.length)for(var t in this.items)BX.unbindAll(this.items[t]);this.items=null},t.JCIblockVoteStars.prototype.preparePercent=function(t){return t=parseInt(t,10),isNaN(t)?t=0:t>100?t=100:t<0&&(t=0),t},t.JCIblockVoteStars.prototype.showProgress=function(t){for(var s in this.items)Math.round(this.voteData.value)>s?this.items[s].className="rate__item is-voted":this.items[s].className="rate__item"},t.JCIblockVoteStars.prototype.showVotes=function(){BX.type.isElementNode(this.ratingObj)&&(this.ratingObj.innerHTML=this.voteData.count)},t.JCIblockVoteStars.prototype.handlerClick=function(s){var e,i=BX.proxy_context;this.config.readOnly||this.config.alreadyVoted||this.config.request||(this.config.request=!0,s=s||t.event,BX.type.isElementNode(this.starsObj)&&(e=this.items.indexOf(i),isNaN(e)||(this.ajaxParams.rating=e,this.ajaxParams.vote="Y",this.ajaxParams.vote_id=this.voteData.element,this.ajaxParams.sessid=BX.bitrix_sessid(),this.ajaxParams.site_id=this.siteId,BX.ajax({timeout:30,method:"POST",dataType:"json",url:this.ajaxUrl,data:this.ajaxParams,onsuccess:BX.proxy(this.clickResult,this)}))))},t.JCIblockVoteStars.prototype.clickResult=function(t){this.config.request=!1,BX.type.isPlainObject(t)&&(this.config.alreadyVoted=!0,this.voteData.percent=this.preparePercent(20*t.value),this.voteData.count=t.votes,this.voteData.value=t.value,this.showProgress(this.voteData.percent),this.showVotes())},t.JCIblockVoteStars.prototype.onMouseover=function(){var t=BX.proxy_context;if(!(this.config.readOnly||this.config.alreadyVoted||this.config.request)){for(var s=this.items.indexOf(t);s>=0;s--)this.items[s].saved_class||(this.items[s].saved_className=this.items[s].className),"is-hover"!=this.items[s].className&&(this.items[s].className+=" is-hover");for(s=this.items.indexOf(t)+1;s<this.items.length;s++)this.items[s].saved_className&&this.items[s].className!=this.items[s].saved_className&&(this.items[s].className=this.items[s].saved_className)}},t.JCIblockVoteStars.prototype.onMouseout=function(){BX.proxy_context;if(!(this.config.readOnly||this.config.alreadyVoted||this.config.request))for(var t=0;t<this.items.length;t++)this.items[t].saved_className&&this.items[t].className!=this.items[t].saved_className&&(this.items[t].className=this.items[t].saved_className)})}(window);