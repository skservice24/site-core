!function(e){e.JCCatalogProductSubscribe||(e.JCCatalogProductSubscribe=function(e){this.buttonId=e.buttonId,this.buttonClass=e.buttonClass,this.subscribeBtnName=e.subscribeBtnName,this.subscribedBtnName=e.subscribedBtnName,this.jsObject=e.jsObject,this.ajaxUrl="/bitrix/components/bitrix/catalog.product.subscribe/ajax.php",this.alreadySubscribed=e.alreadySubscribed,this.listIdAlreadySubscribed=e.listIdAlreadySubscribed,this.urlListSubscriptions=e.urlListSubscriptions,this.listOldItemId={},this.landingId=e.landingId,this.productName=e.productName,this.ImageUrl=e.ImageUrl,this.artnumber=e.artnumber,this.USE_CAPTCHA=e.USE_CAPTCHA,this.elemButtonSubscribe=null,this.elemPopupWin=null,this.defaultButtonClass="bx-catalog-subscribe-button",this._elemButtonSubscribeClickHandler=BX.delegate(this.subscribe,this),this._elemHiddenClickHandler=BX.delegate(this.checkSubscribe,this),BX.ready(BX.delegate(this.init,this))},e.JCCatalogProductSubscribe.prototype.init=function(){this.buttonId&&(this.elemButtonSubscribe=BX(this.buttonId),this.elemHiddenSubscribe=BX(this.buttonId+"_hidden")),this.elemButtonSubscribe&&BX.bind(this.elemButtonSubscribe,"click",this._elemButtonSubscribeClickHandler),this.elemHiddenSubscribe&&BX.bind(this.elemHiddenSubscribe,"click",this._elemHiddenClickHandler),this.setButton(this.alreadySubscribed),this.setIdAlreadySubscribed(this.listIdAlreadySubscribed)},e.JCCatalogProductSubscribe.prototype.checkSubscribe=function(){this.elemHiddenSubscribe&&this.elemButtonSubscribe&&(this.listOldItemId.hasOwnProperty(this.elemButtonSubscribe.dataset.item)?this.setButton(!0):BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:{sessid:BX.bitrix_sessid(),checkSubscribe:"Y",itemId:this.elemButtonSubscribe.dataset.item},onsuccess:BX.delegate(function(e){e.subscribe?(this.setButton(!0),this.listOldItemId[this.elemButtonSubscribe.dataset.item]=!0):this.setButton(!1)},this)}))},e.JCCatalogProductSubscribe.prototype.subscribe=function(){if(this.elemButtonSubscribe=BX.proxy_context,!this.elemButtonSubscribe)return!1;BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:{sessid:BX.bitrix_sessid(),subscribe:"Y",itemId:this.elemButtonSubscribe.dataset.item,siteId:BX.message("SITE_ID"),landingId:this.landingId},onsuccess:BX.delegate(function(e){if(e.success)this.createSuccessPopup(e),this.setButton(!0),this.listOldItemId[this.elemButtonSubscribe.dataset.item]=!0;else if(e.contactFormSubmit){var t=this.createContentForPopup(e),s=BX.create("div",{children:[BX.create("div",{props:{className:"subscribe-form-flex"},children:[BX.create("div",{props:{className:"subscribe-form-flex-block_img"},html:'<img src="'+this.ImageUrl+'">'}),BX.create("div",{props:{className:"subscribe-form-flex-block_inf"},children:[BX.create("div",{props:{className:"subscribe-form-flex-block_name"},text:this.productName}),BX.create("div",{props:{className:"subscribe-form-flex-block_art"},html:BX.message("CPST_SUBSCRIBE_ARTNUMBER")+this.artnumber+""})]})]}),t,BX.create("div",{props:{className:"bmd-form-group btn-primary-subscribe-button btn-primary-mobile"},children:[BX.create("button",{text:BX.message("CPST_SUBSCRIBE_BUTTON_NAME"),props:{className:"btn btn-primary btn-primary-mobile"},events:{click:BX.delegate(function(){if(!this.validateContactField(e.contactTypeData))return!1;BX.ajax.submitAjax(t,{method:"POST",url:this.ajaxUrl,processData:!0,onsuccess:BX.delegate(function(e){if((e=BX.parseJSON(e,{})).success)this.createSuccessPopup(e),this.setButton(!0),this.listOldItemId[this.elemButtonSubscribe.dataset.item]=!0;else if(e.error){e.hasOwnProperty("setButton")&&(this.listOldItemId[this.elemButtonSubscribe.dataset.item]=!0,this.setButton(!0));var t=e.message;e.hasOwnProperty("typeName")&&(t=e.message.replace("USER_CONTACT",e.typeName)),BX.addClass(BX("bx-catalog-subscribe-form-notify"),"alert alert-danger"),BX("bx-catalog-subscribe-form-notify").innerHTML=t}},this)})},this)}})]})]});this.showPopup(s,{title:BX.message("CPST_SUBSCRIBE_POPUP_TITLE")}),"Y"==this.USE_CAPTCHA&&($("form").removeClass("subscribe-form-email"),$("div").removeClass("btn-primary-subscribe-button"))}else e.error&&(e.hasOwnProperty("setButton")&&(this.listOldItemId[this.elemButtonSubscribe.dataset.item]=!0,this.setButton(!0)),this.showWindowWithAnswer({status:"error",message:e.message}))},this)})},e.JCCatalogProductSubscribe.prototype.validateContactField=function(e){var t=BX.findChildren(BX("bx-catalog-subscribe-form"),{tag:"input",attribute:{id:"userContact"}},!0);if(!t.length||"object"!=typeof e)return BX.addClass(BX("bx-catalog-subscribe-form-notify"),"alert alert-danger"),BX("bx-catalog-subscribe-form-notify").innerHTML=BX.message("CPST_SUBSCRIBE_VALIDATE_UNKNOW_ERROR"),!1;for(var s,a,i,r=[],c=[],o=0;o<t.length;o++)s=t[o].getAttribute("data-id"),a=t[o].value,(i=BX("bx-contact-use-"+s))&&"N"==i.value?c.push(!0):a.length||r.push(BX.message("CPST_SUBSCRIBE_VALIDATE_ERROR_EMPTY_FIELD").replace("#FIELD#",e[s].contactLable));if(t.length==c.length)return BX.addClass(BX("bx-catalog-subscribe-form-notify"),"alert alert-danger"),BX("bx-catalog-subscribe-form-notify").innerHTML=BX.message("CPST_SUBSCRIBE_VALIDATE_ERROR"),!1;if(r.length){BX.addClass(BX("bx-catalog-subscribe-form-notify"),"alert alert-danger");for(var l=0;l<r.length;l++)BX("bx-catalog-subscribe-form-notify").innerHTML=r[l];return!1}return!0},e.JCCatalogProductSubscribe.prototype.reloadCaptcha=function(){BX.ajax.get(this.ajaxUrl+"?reloadCaptcha=Y","",function(e){BX("captcha_sid").value=e,BX("captcha_img").src="/bitrix/tools/captcha.php?captcha_sid="+e})},e.JCCatalogProductSubscribe.prototype.createContentForPopup=function(e){if(!e.hasOwnProperty("contactTypeData"))return null;var t=e.contactTypeData,s=Object.keys(t).length,a="",i="N",r=document.createDocumentFragment();for(var c in s>1&&(i="Y",a={display:"none"},r.appendChild(BX.create("p",{text:BX.message("CPST_SUBSCRIBE_MANY_CONTACT_NOTIFY")}))),r.appendChild(BX.create("p",{props:{id:"bx-catalog-subscribe-form-notify"}})),t)s>1&&r.appendChild(BX.create("div",{props:{className:"bx-catalog-subscribe-form-container"},children:[BX.create("div",{props:{className:"checkbox"},children:[BX.create("lable",{props:{className:"bx-filter-param-label"},attrs:{onclick:this.jsObject+".selectContactType("+c+", event);"},children:[BX.create("input",{props:{type:"hidden",id:"bx-contact-use-"+c,name:"contact["+c+"][use]",value:"N"}}),BX.create("input",{props:{id:"bx-contact-checkbox-"+c,type:"checkbox"}}),BX.create("span",{props:{className:"bx-filter-param-text"},text:t[c].contactLable})]})]})]})),r.appendChild(BX.create("div",{props:{id:"bx-catalog-subscribe-form-container-"+c,className:"form-group bmd-form-group"},style:a,children:[BX.create("label",{props:{className:"bmd-label-floating"},text:BX.message("CPST_SUBSCRIBE_LABLE_CONTACT_INPUT").replace("#CONTACT#",t[c].contactLable)}),BX.create("input",{props:{id:"userContact",className:"bmd-form-control",type:"text",name:"contact["+c+"][user]",required:"1"},attrs:{"data-id":c}})]}));e.hasOwnProperty("captchaCode")&&r.appendChild(BX.create("div",{props:{className:"d-block captcha-wrap mt-5"},children:[BX.create("label",{props:{className:"small text-extra",for:"test"},attrs:{},children:[BX.message("CPST_ENTER_WORD_PICTURE")+" ",BX.create("span",{props:{className:"text-danger"},text:"*"})]}),BX.create("div",{props:{className:"d-flex"},children:[BX.create("div",{props:{className:"d-block flex-grow-1 pr-5"},children:[BX.create("div",{props:{className:"bmd-form-group d-inline"},children:[BX.create("input",{props:{id:"captcha_word",className:"bmd-form-control",type:"text",name:"captcha_word"},attrs:{maxlength:"50"}})]})]}),BX.create("div",{props:{className:"d-block"},children:[BX.create("input",{props:{type:"hidden",id:"captcha_sid",name:"captcha_sid",value:e.captchaCode}}),BX.create("img",{props:{id:"captcha_img",className:"mw-none",src:"/bitrix/tools/captcha.php?captcha_sid="+e.captchaCode},attrs:{alt:"captcha",onclick:this.jsObject+".reloadCaptcha();"}})]})]})]}));var o=BX.create("form",{props:{id:"bx-catalog-subscribe-form",className:"was-validated subscribe-form-email"},children:[BX.create("input",{props:{type:"hidden",name:"manyContact",value:i}}),BX.create("input",{props:{type:"hidden",name:"sessid",value:BX.bitrix_sessid()}}),BX.create("input",{props:{type:"hidden",name:"itemId",value:this.elemButtonSubscribe.dataset.item}}),BX.create("input",{props:{type:"hidden",name:"landingId",value:this.landingId}}),BX.create("input",{props:{type:"hidden",name:"siteId",value:BX.message("SITE_ID")}}),BX.create("input",{props:{type:"hidden",name:"contactFormSubmit",value:"Y"}})]});return o.appendChild(r),o},e.JCCatalogProductSubscribe.prototype.selectContactType=function(t,s){var a=BX("bx-catalog-subscribe-form-container-"+t),i="",r=BX("bx-contact-checkbox-"+t);if(!a)return!1;if(r!=s.target&&(r.checked?r.checked=!1:r.checked=!0),a.currentStyle)i=a.currentStyle.display;else if(e.getComputedStyle){i=e.getComputedStyle(a,null).getPropertyValue("display")}"none"===i?(BX("bx-contact-use-"+t).value="Y",BX.style(a,"display","")):(BX("bx-contact-use-"+t).value="N",BX.style(a,"display","none"))},e.JCCatalogProductSubscribe.prototype.createSuccessPopup=function(e){var t=BX.create("div",{props:{className:""},children:[BX.create("div",{props:{className:"mt-6 d-flex align-items-center"},children:[BX.create("div",{props:{className:"d-block text-primary mr-4"},html:'<svg class="icon-svg" style="font-size: 2.5rem;"><use xlink:href="#svg-select-circle"></use></svg>'}),BX.create("div",{props:{className:"d-block"},text:e.message})]})]});this.showPopup(t,{title:BX.message("CPST_SUBSCRIBE_POPUP_TITLE")})},e.JCCatalogProductSubscribe.prototype.setButton=function(e){this.alreadySubscribed=Boolean(e),this.alreadySubscribed?(this.elemButtonSubscribe.className=this.buttonClass+" "+this.defaultButtonClass,this.elemButtonSubscribe.innerHTML="<span>"+this.subscribedBtnName+"</span>",BX.unbind(this.elemButtonSubscribe,"click",this._elemButtonSubscribeClickHandler)):(this.elemButtonSubscribe.className=this.buttonClass+" "+this.defaultButtonClass,this.elemButtonSubscribe.innerHTML="<span>"+this.subscribeBtnName+"</span>",BX.bind(this.elemButtonSubscribe,"click",this._elemButtonSubscribeClickHandler))},e.JCCatalogProductSubscribe.prototype.setIdAlreadySubscribed=function(e){BX.type.isPlainObject(e)&&(this.listOldItemId=e)},e.JCCatalogProductSubscribe.prototype.showWindowWithAnswer=function(e){(e=e||{}).message||("success"==e.status?e.message=BX.message("CPST_STATUS_SUCCESS"):e.message=BX.message("CPST_STATUS_ERROR"));var t=BX.create("div",{props:{className:""},children:[BX.create("div",{props:{className:"mt-6 d-flex align-items-center"},children:[BX.create("div",{props:{className:"d-block text-primary mr-4"},html:'<svg class="icon-svg" style="font-size: 2.5rem;"><use xlink:href="#svg-select-circle"></use></svg>'}),BX.create("div",{props:{className:"d-block"},text:e.message})]})]});this.showPopup(t,{title:BX.message("CPST_SUBSCRIBE_POPUP_TITLE")})},e.JCCatalogProductSubscribe.prototype.showPopup=function(e,t){var s=$.fancybox.getInstance();s?(s.trigger("beforeShow",!1),s.trigger("beforeLoad",s.current),s.setContent(s.current,e)):RS.Utils.popup(e,"window",t)})}(window);