!function(t){"use strict";t.RSCatalogSorter||(t.RSCatalogSorter=function(t){this.items=[],this.errorCode=0,this.node={},this.target=null,this.sorter=null,this.pagination=null,this.lazyload=null,"object"==typeof t&&(this.visual=t.VISUAL),0===this.errorCode&&BX.ready(BX.delegate(this.init,this))},t.RSCatalogSorter.prototype={init:function(){this.obSorter=BX(this.visual.ID),this.obSorter||(this.errorCode=-1),this.items=BX.findChildren(this.obSorter,{tagName:"a"},!0),this.items.length>0&&BX.bindDelegate(this.obSorter,"click",{tagName:"a"},BX.proxy(this.linkClick,this)),this.forms=BX.findChildren(this.obSorter,{tagName:"select"},!0),this.forms.length>0&&BX.bindDelegate(this.obSorter,"change",{tagName:"select"},BX.proxy(this.selectChange,this)),this.ajaxId=this.visual.TARGET_ID,this.ajaxId&&(this.node.target=BX(this.ajaxId)),this.node.target&&(this.node.container=this.node.target.querySelector('[data-entity^="container-"]'),this.node.pagination=this.node.target.querySelectorAll('[data-entity="pagination"]'),this.node.lazyload=this.node.target.querySelector('[data-entity="lazyload"]'))},selectChange:function(e){e.preventDefault();var i=BX.proxy_context;if(i){var s={},o=t.location.href,a={action:"updateItems",AJAX_ID:this.ajaxId};new FormData(i.form).forEach(function(t,e){a[e]=t}),o=BX.util.add_url_param(o,a),s.action="updateItems",this.formPosting||(this.formPosting=!0,this.showWait(),this.sendRequest(o,s)),e.preventDefault()}},linkClick:function(t){var e=BX.proxy_context;if(e){var i={},s=e.getAttribute("href"),o={action:"updateItems",AJAX_ID:this.ajaxId};i.action="updateItems",s=BX.util.add_url_param(s,o),this.formPosting||(this.formPosting=!0,this.showWait(),this.sendRequest(s,i)),t.preventDefault()}},sendRequest:function(t,e){var i={};this.ajaxId&&(i.AJAX_ID=this.ajaxId),BX.ajax({url:-1!==t.indexOf("clear_cache=Y")?BX.util.add_url_param(t,{clear_cache:"Y"}):t,method:"POST",dataType:"json",timeout:60,data:BX.merge(i,e),onsuccess:BX.delegate(function(t){t&&t.JS&&BX.ajax.processScripts(BX.processHTML(t.JS).SCRIPT,!1,BX.delegate(function(){this.showAction(t,e)},this))},this)})},showAction:function(t,e){if(e)switch(e.action){case"updateItems":this.processCatalogRefreshAction(t)}},processCatalogRefreshAction:function(t){this.formPosting=!1,t&&(this.refresh(t.sorter),this.processSection(t.section),this.closeWait())},processSection:function(t){if(t){var e=BX.processHTML(t,!1);this.node.target&&(this.node.target.innerHTML=e.HTML),BX.ajax.processScripts(e.SCRIPT),void 0!==RS&&RS.Init(["popup"],this.node.target)}},refresh:function(t){if(t){var e=BX.processHTML(t,!1);this.obSorter&&(this.obSorter.innerHTML=e.HTML),BX.ajax.processScripts(e.SCRIPT),void 0!==RS&&RS.Init([],this.obSorter)}},showWait:function(){BX.addClass(this.node.target,"overlay is-loading")},closeWait:function(){BX.removeClass(this.node.target,"overlay is-loading")}})}(window);