window.RS||(window.RS={}),window.RS.ShopList=function(){var e=function(e){this.init=function(t){this.map=new google.maps.Map(e,{center:{lat:parseFloat(t.center[0]),lng:parseFloat(t.center[1])},zoom:parseInt(t.zoom)}),this.clusterer=new MarkerClusterer(this.map,{},{imagePath:"https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m"})},this.setMarker=function(e){if(!this.map)throw new Error("map is not defined");if(!e.marker&&e.coords){var t=new google.maps.InfoWindow({content:e.mapPopupContent});e.marker=new google.maps.Marker({position:{lat:parseFloat(e.coords[0]),lng:parseFloat(e.coords[1])},title:e.name}),e.marker.addListener("click",function(){t.open(this.map,e.marker)}.bind(this))}else e.marker.setVisible(!0);this.clusterer.addMarker(e.marker)},this.removeMarker=function(e){if(!this.map)throw new Error("map is not defined");e.marker&&(this.clusterer.removeMarker(e.marker),e.marker.setVisible(!1),e.marker.setMap(null)),this.clusterer.resetViewport()}},t=function(e){this.init=function(t){this.map=new ymaps.Map(e,{center:t.center,zoom:t.zoom,controls:["zoomControl"]}),this.clusterer=new ymaps.Clusterer({groupByCoordinates:!1,clusterDisableClickZoom:!0,clusterHideIconOnBalloonOpen:!1,geoObjectHideIconOnBalloonOpen:!1}),this.map.geoObjects.add(this.clusterer)},this.setMarker=function(e){if(!this.map)throw new Error("map is not defined");!e.marker&&e.coords&&(e.marker=new ymaps.Placemark(e.coords,{clusterCaption:e.name,balloonContentBody:e.mapPopupContent})),this.clusterer.add(e.marker)},this.removeMarker=function(e){if(!this.map)throw new Error("map is not defined");e.marker&&this.clusterer.remove(e.marker)}};function r(e){this.container=document.getElementById(e.CONTAINER_ID),this.map=document.getElementById(e.MAP_ID),this.filters={},this.prepareItems(e.ITEMS),this.bindEvents();var t=e.MAP_PROVIDER,r={center:e.MAP_CENTER_COORDS,zoom:e.MAP_ZOOM};this.initMap(t,r)}return r.prototype.prepareItems=function(e){var t,r,i,s;for(t in this.items={},e)e.hasOwnProperty(t)&&(i=(r=e[t]).ITEM_ID,s=this.container.querySelector('[data-item="'+i+'"]'),this.items[i]={id:i,name:r.NAME,filters:r.FILTERS,isHidden:!1,el:s,coords:[parseFloat(r.COORDS[0]),parseFloat(r.COORDS[1])],mapPopupContent:r.PREVIEW_TEXT})},r.prototype.initMap=function(r,i){switch(r){case"google":this.mapProvider=new e(this.map);break;case"yandex":default:this.mapProvider=new t(this.map)}this.mapProvider.init(i),this.updateMarkers()},r.prototype.bindEvents=function(){this.bindFilterEvents()},r.prototype.bindFilterEvents=function(){var e,t=this.container.querySelectorAll("[data-filter]"),r=this;if(t)for(e in t)t.hasOwnProperty(e)&&t[e].addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("data-filter"),i=this.getAttribute("data-filter-val");r.filters[t]=i,r.filterItems(),r.updateMarkers(),r.toggleFilterButton(this)})},r.prototype.toggleFilterButton=function(e,t){if(e.classList.contains("dropdown-item"))e.parentNode.parentNode.querySelector(".dropdown-toggle").innerText=e.innerText;else if(e.classList.contains("btn")){var r=e.parentNode.querySelector(".btn-primary");r.classList.remove("btn-primary"),r.classList.add("btn-outline-secondary-primary"),e.classList.remove("btn-outline-secondary-primary"),e.classList.add("btn-primary")}},r.prototype.filterItems=function(){var e,t,r;for(e in this.items)if(this.items.hasOwnProperty(e))for(r in t=this.items[e],itemFilters=t.filters,t.isHidden=!1,t.el.classList.remove("d-none"),this.filters)this.filters.hasOwnProperty(r)&&itemFilters[r]&&""!=this.filters[r].trim()&&itemFilters[r]!=this.filters[r]&&(t.isHidden=!0,t.el.classList.add("d-none"))},r.prototype.updateMarkers=function(){var e,t;for(e in this.items)this.items.hasOwnProperty(e)&&((t=this.items[e]).isHidden?this.mapProvider.removeMarker(t):this.mapProvider.setMarker(t))},r}();