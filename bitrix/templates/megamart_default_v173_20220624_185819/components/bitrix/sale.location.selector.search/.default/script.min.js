BX.namespace("BX.Sale.component.location.selector"),void 0===BX.Sale.component.location.selector.search&&void 0!==BX.ui&&void 0!==BX.ui.widget&&(BX.Sale.component.location.selector.search=function(e,t){this.parentConstruct(BX.Sale.component.location.selector.search,e),BX.merge(this,{opts:{usePagingOnScroll:!0,pageSize:10,arrowScrollAdditional:2,pageUpWardOffset:3,provideLinkBy:"id",bindEvents:{"after-input-value-modify":function(){this.ctrls.fullRoute.value=""},"after-select-item":function(e){this.opts;var t=this.vars.cache.nodes[e],s=t.DISPLAY;if("object"==typeof t.PATH)for(var i=0;i<t.PATH.length;i++)s+=", "+this.vars.cache.path[t.PATH[i]];this.ctrls.inputs.fake.setAttribute("title",s),this.ctrls.fullRoute.value=s,"string"==typeof this.opts.callback&&this.opts.callback.length>0&&this.opts.callback in window&&window[this.opts.callback].apply(this,[e,this])},"after-deselect-item":function(){this.ctrls.fullRoute.value="",this.ctrls.inputs.fake.setAttribute("title","")},"before-render-variant":function(e){if(e.PATH.length>0){for(var t="",s=0;s<e.PATH.length;s++)t+=", "+this.vars.cache.path[e.PATH[s]];e.PATH=t}else e.PATH="";var i="";if(this.vars&&this.vars.lastQuery&&this.vars.lastQuery.QUERY&&(i=this.vars.lastQuery.QUERY),BX.type.isNotEmptyString(i)){var o=[];o=this.opts.wrapSeparate?i.split(/\s+/):[i],e["=display_wrapped"]=BX.util.wrapSubstring(e.DISPLAY+e.PATH,o,this.opts.wrapTagName,!0)}else e["=display_wrapped"]=BX.util.htmlspecialchars(e.DISPLAY)}}},vars:{cache:{path:{},nodesByCode:{}}},sys:{code:"sls"}}),this.handleInitStack(t,BX.Sale.component.location.selector.search,e)},BX.extend(BX.Sale.component.location.selector.search,BX.ui.autoComplete),BX.merge(BX.Sale.component.location.selector.search.prototype,{init:function(){"object"==typeof this.opts.pathNames&&BX.merge(this.vars.cache.path,this.opts.pathNames),this.pushFuncStack("buildUpDOM",BX.Sale.component.location.selector.search),this.pushFuncStack("displayVariants",BX.Sale.component.location.selector.search),this.pushFuncStack("bindEvents",BX.Sale.component.location.selector.search)},buildUpDOM:function(){var e=this.ctrls,t=(this.opts,this.vars,this.sys.code);e.fullRoute=BX.create("input",{props:{className:"bx-ui-"+t+"-route"},attrs:{type:"text",disabled:"disabled",autocomplete:"off"}}),BX.prepend(e.fullRoute,e.container),e.inputBlock=this.getControl("input-block"),e.loader=this.getControl("loader"),document.body.appendChild(e.pane),e.pane.style.position="absolute",e.inputs.fake.classList.add("form-control"),e.fullRoute.classList.add("form-control")},displayVariants:function(e,t){var s=this.ctrls,i=s.scope.getBoundingClientRect();BX.Sale.component.location.selector.search.superclass.displayVariants.call(this,e,t),s.pane.classList.add("dropdown-menu"),s.pane.classList.add("show"),$(s.vars).removeData(),RS.Init(["bmd"],s.vars),s.pane.style.left=i.left+"px",s.pane.style.top=i.top+i.height+window.pageYOffset+"px",s.pane.style.bottom="auto",s.pane.style.width=i.width+"px",window.innerHeight<i.top+i.height+250?s.pane.style.top=i.top+window.pageYOffset-BX.height(s.pane)-2+"px":s.pane.style.top=i.top+i.height+window.pageYOffset+"px"},showNothingFound:function(){BX.Sale.component.location.selector.search.superclass.showNothingFound.call(this);var e=this.ctrls,t=e.scope.getBoundingClientRect();e.pane.style.left=t.left+"px",e.pane.style.top=t.top+t.height+window.pageYOffset+"px",e.pane.style.bottom="auto",e.pane.style.width=t.width+"px",window.innerHeight<t.top+t.height+250?e.pane.style.top=t.top+window.pageYOffset-BX.height(e.pane)-2+"px":e.pane.style.top=t.top+t.height+window.pageYOffset+"px"},bindEvents:function(){var e=this;BX.bindDelegate(this.getControl("quick-locations",!0),"click",{tag:"a"},function(){e.setValueByLocationId(BX.data(this,"id"))}),this.vars.outSideClickScope=this.ctrls.inputBlock},setValueByLocationId:function(e,t){BX.Sale.component.location.selector.search.superclass.setValue.apply(this,[e,t])},setValueByLocationIds:function(e){e.IDS&&this.displayPage({VALUE:e.IDS,order:{TYPE_ID:"ASC","NAME.NAME":"ASC"}})},setValueByLocationCode:function(e,t){var s=this.vars,i=this.opts,o=this.ctrls,a=this;if(this.hideError(),null==e||0==e||void 0===e||0==e.toString().length)return this.resetVariables(),BX.cleanNode(o.vars),BX.type.isElementNode(o.nothingFound)&&BX.hide(o.nothingFound),this.fireEvent("after-deselect-item"),void this.fireEvent("after-clear-selection");if(!1!==t&&(s.forceSelectSingeOnce=!0),void 0===s.cache.nodesByCode[e])this.resetNavVariables(),a.downloadBundle({CODE:e},function(t){if(a.fillCache(t,!1),void 0===s.cache.nodesByCode[e])a.showNothingFound();else{var o=s.cache.nodesByCode[e].VALUE;i.autoSelectIfOneVariant||s.forceSelectSingeOnce?a.selectItem(o):a.displayVariants([o])}},function(){s.forceSelectSingeOnce=!1});else{var n=s.cache.nodesByCode[e].VALUE;s.forceSelectSingeOnce?this.selectItem(n):this.displayVariants([n]),s.forceSelectSingeOnce=!1}},getNodeByValue:function(e){return"id"==this.opts.provideLinkBy?this.vars.cache.nodes[e]:this.vars.cache.nodesByCode[e]},getNodeByLocationId:function(e){return this.vars.cache.nodes[e]},setValue:function(e){"id"==this.opts.provideLinkBy?BX.Sale.component.location.selector.search.superclass.setValue.apply(this,[e]):this.setValueByLocationCode(e)},getValue:function(){return"id"==this.opts.provideLinkBy?!1===this.vars.value?"":this.vars.value:this.vars.value?this.vars.cache.nodes[this.vars.value].CODE:""},getSelectedPath:function(){var e=this.vars,t=[];if(void 0===e.value||0==e.value||""==e.value)return t;if(void 0!==e.cache.nodes[e.value]){void 0!==(o=BX.clone(e.cache.nodes[e.value])).TYPE_ID&&void 0!==this.opts.types&&(o.TYPE=this.opts.types[o.TYPE_ID].CODE);var s=o.PATH;if(delete o.PATH,t.push(o),void 0!==s)for(var i in s){var o;void 0!==(o=BX.clone(e.cache.nodes[s[i]])).TYPE_ID&&void 0!==this.opts.types&&(o.TYPE=this.opts.types[o.TYPE_ID].CODE),delete o.PATH,t.push(o)}}return t},setInitialValue:function(){!1!==this.opts.selectedItem?this.setValueByLocationId(this.opts.selectedItem):this.ctrls.inputs.origin.value.length>0&&("id"==this.opts.provideLinkBy?this.setValueByLocationId(this.ctrls.inputs.origin.value):this.setValueByLocationCode(this.ctrls.inputs.origin.value))},addItem2Cache:function(e){this.vars.cache.nodes[e.VALUE]=e,this.vars.cache.nodesByCode[e.CODE]=e},refineRequest:function(e){var t={};void 0!==e.QUERY&&(t["=PHRASE"]=e.QUERY),void 0!==e.VALUE&&(t["=ID"]=e.VALUE),void 0!==e.CODE&&(t["=CODE"]=e.CODE),void 0!==this.opts.query.BEHAVIOUR.LANGUAGE_ID&&(t["=NAME.LANGUAGE_ID"]=this.opts.query.BEHAVIOUR.LANGUAGE_ID),BX.type.isNotEmptyString(this.opts.query.FILTER.SITE_ID)&&(t["=SITE_ID"]=this.opts.query.FILTER.SITE_ID);var s={select:{VALUE:"ID",DISPLAY:"NAME.NAME",1:"CODE",2:"TYPE_ID"},additionals:{1:"PATH"},filter:t,version:"2"};return void 0!==e.order&&(s.order=e.order),s},refineResponce:function(e,t){if(void 0!==e.ETC.PATH_ITEMS){for(var s in e.ETC.PATH_ITEMS)BX.type.isNotEmptyString(e.ETC.PATH_ITEMS[s].DISPLAY)&&(this.vars.cache.path[s]=e.ETC.PATH_ITEMS[s].DISPLAY);for(var s in e.ITEMS){var i=e.ITEMS[s];if(void 0!==i.PATH){var o=BX.clone(i.PATH);for(var a in i.PATH){var n=i.PATH[a];if(o.shift(),void 0===this.vars.cache.nodes[n]&&void 0!==e.ETC.PATH_ITEMS[n]){var c=BX.clone(e.ETC.PATH_ITEMS[n]);c.PATH=BX.clone(o),this.vars.cache.nodes[n]=c}}}}}return e.ITEMS},refineItems:function(e){return e},refineItemDataForTemplate:function(e){return e},getSelectorValue:function(e){return"id"==this.opts.provideLinkBy?e:void 0!==this.vars.cache.nodes[e]?this.vars.cache.nodes[e].CODE:""},whenLoaderToggle:function(e){BX[e?"show":"hide"](this.ctrls.loader)}}));