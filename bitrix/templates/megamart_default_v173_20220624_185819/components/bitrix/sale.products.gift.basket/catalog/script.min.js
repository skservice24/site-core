!function(e){"use strict";var t=function(){function e(t){babelHelpers.classCallCheck(this,e),this.formPosting=!1,this.siteId=t.siteId||"",this.template=t.template||"",this.componentPath=t.componentPath||"",this.parameters=t.parameters||"",this.container=document.querySelector('[data-entity="'+t.container+'"]'),this.currentProductId=t.currentProductId,t.initiallyShowHeader&&BX.ready(BX.proxy(this.showHeader,this)),t.deferredLoad&&BX.ready(BX.proxy(this.deferredLoad,this)),BX.addCustomEvent("OnBasketChange",BX.proxy(this.reloadGifts,this)),BX.addCustomEvent("OnCouponApply",BX.proxy(this.reloadGifts,this))}return babelHelpers.createClass(e,[{key:"reloadGifts",value:function(){this.sendRequest({action:"deferredLoad",recalculateDiscounts:"Y"})}},{key:"deferredLoad",value:function(){this.sendRequest({action:"deferredLoad"})}},{key:"sendRequest",value:function(e){var t={siteId:this.siteId,template:this.template,parameters:this.parameters};BX.ajax({url:this.componentPath+"/ajax.php"+(-1!==document.location.href.indexOf("clear_cache=Y")?"?clear_cache=Y":""),method:"POST",dataType:"json",timeout:60,data:BX.merge(t,e),onsuccess:BX.delegate(function(t){if(!t||!t.JS)return this.hideHeader(),void BX.cleanNode(this.container);BX.ajax.processScripts(BX.processHTML(t.JS).SCRIPT,!1,BX.delegate(function(){this.showAction(t,e)},this))},this)})}},{key:"showAction",value:function(e,t){if(t)switch(t.action){case"deferredLoad":this.processDeferredLoadAction(e)}}},{key:"processDeferredLoadAction",value:function(e){e&&this.processItems(e.items)}},{key:"processItems",value:function(e){if(e){var t,a,i=BX.processHTML(e,!1),s=BX.create("DIV");for(a in s.innerHTML=i.HTML,this.container.querySelectorAll('[data-entity="items-row"]').length?(BX.cleanNode(this.container),this.showHeader(!1)):this.showHeader(!0),t=s.querySelectorAll('[data-entity="items-row"]'))t.hasOwnProperty(a)&&(t[a].style.opacity=0,this.container.appendChild(t[a]));new BX.easing({duration:2e3,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){for(var a in t)t.hasOwnProperty(a)&&(t[a].style.opacity=e.opacity/100)},complete:function(){for(var e in t)t.hasOwnProperty(e)&&t[e].removeAttribute("style")}}).animate(),BX.ajax.processScripts(i.SCRIPT)}}},{key:"showHeader",value:function(e){var t,a=BX.findParent(this.container,{attr:{"data-entity":"parent-container"}});a&&BX.type.isDomNode(a)&&(a.style.display="",(t=a.querySelector('[data-entity="header"]'))&&"false"===t.getAttribute("data-showed")&&(t.style.display="",e?(this.animation=new BX.easing({duration:2e3,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){t.style.opacity=e.opacity/100},complete:function(){t.removeAttribute("style"),t.setAttribute("data-showed","true")}}),this.animation.animate()):t.style.opacity=100))}},{key:"hideHeader",value:function(){var e,t=BX.findParent(this.container,{attr:{"data-entity":"parent-container"}});t&&BX.type.isDomNode(t)&&(e=t.querySelector('[data-entity="header"]'))&&(this.animation&&this.animation.stop(),e.style.display="none",e.style.opacity=0,e.setAttribute("data-showed","false"))}}]),e}();e.JCSaleProductsGiftBasketMegamart=t}(this.window=this.window||{});