!function(t){"use strict";if(!t.JCCatalogItem){var i=function(t){i.superclass.constructor.apply(this,arguments),this.buttonNode=BX.create("button",{props:{className:"btn btn-default btn-buy btn-sm",id:this.id},style:"object"==typeof t.style?t.style:{},text:t.text,events:this.contextEvents}),BX.browser.IsIE()&&this.buttonNode.setAttribute("hideFocus","hidefocus")};BX.extend(i,BX.PopupWindowButton),t.JCCatalogItem=function(t){if(this.productType=0,this.showQuantity=!0,this.showAbsent=!0,this.secondPict=!1,this.showOldPrice=!1,this.showMaxQuantity="N",this.relativeQuantityFactor=5,this.showPercent=!1,this.showSkuProps=!1,this.basketAction="ADD",this.showClosePopup=!1,this.useCompare=!1,this.showSubscription=!1,this.useOfferName=!1,this.visual={ID:"",NAME:"",PICT_ID:"",SECOND_PICT_ID:"",PICT_SLIDER_ID:"",QUANTITY_ID:"",QUANTITY_UP_ID:"",QUANTITY_DOWN_ID:"",PRICE_ID:"",PRICE_OLD_ID:"",DSC_PERC:"",SECOND_DSC_PERC:"",DISPLAY_PROP_DIV:"",BASKET_PROP_DIV:"",SUBSCRIBE_ID:""},this.product={checkQuantity:!1,maxQuantity:0,stepQuantity:1,isDblQuantity:!1,canBuy:!0,name:"",pict:{},id:0,addUrl:"",buyUrl:""},this.basketMode="",this.basketData={useProps:!1,emptyProps:!1,quantity:"quantity",props:"prop",basketUrl:"",sku_props:"",sku_props_var:"basket_props",add_url:"",buy_url:""},this.compareData={compareUrl:"",compareDeleteUrl:"",comparePath:""},this.defaultPict={pict:null,secondPict:null},this.defaultSliderOptions={interval:3e3,wrap:!0},this.slider={options:{},items:[],active:null,sliding:null,paused:null,interval:null,progress:null},this.touch=null,this.quantityDelay=null,this.quantityTimer=null,this.checkQuantity=!1,this.maxQuantity=0,this.minQuantity=0,this.stepQuantity=1,this.isDblQuantity=!1,this.canBuy=!0,this.precision=6,this.precisionFactor=Math.pow(10,this.precision),this.bigData=!1,this.fullDisplayMode=!1,this.viewMode="",this.templateTheme="",this.currentPriceMode="",this.currentPrices=[],this.currentPriceSelected=0,this.currentQuantityRanges=[],this.currentQuantityRangeSelected=0,this.offers=[],this.offerNum=0,this.treeProps=[],this.selectedValues={},this.obProduct=null,this.blockNodes={},this.obQuantity=null,this.obQuantityUp=null,this.obQuantityDown=null,this.obQuantityLimit={},this.obPict=null,this.obSecondPict=null,this.obName=null,this.obPictSlider=null,this.obPictSliderIndicator=null,this.obPrice=null,this.obTree=null,this.obBuyBtn=null,this.obBasketActions=null,this.obNotAvail=null,this.obSubscribe=null,this.obDscPerc=null,this.obSecondDscPerc=null,this.obSkuProps=null,this.obMeasure=null,this.obCompare=null,this.obPopupWin=null,this.basketUrl="",this.basketParams={},this.isTouchDevice=BX.hasClass(document.documentElement,"bx-touch"),this.hoverTimer=null,this.hoverStateChangeForbidden=!1,this.mouseX=null,this.mouseY=null,this.useEnhancedEcommerce=!1,this.dataLayerName="dataLayer",this.brandProperty=!1,this.useFavorite=!1,this.obFavorite=null,this.obProductRequestBtn="",this.useLazyImages=!0,this.errorCode=0,"object"==typeof t){switch(t.PRODUCT_TYPE&&(this.productType=parseInt(t.PRODUCT_TYPE,10)),this.showQuantity=t.SHOW_QUANTITY,this.showAbsent=t.SHOW_ABSENT,this.secondPict=t.SECOND_PICT,this.showOldPrice=t.SHOW_OLD_PRICE,this.showMaxQuantity=t.SHOW_MAX_QUANTITY,this.relativeQuantityFactor=parseInt(t.RELATIVE_QUANTITY_FACTOR),this.showPercent=t.SHOW_DISCOUNT_PERCENT,this.showSkuProps=t.SHOW_SKU_PROPS,this.showSubscription=t.USE_SUBSCRIBE,this.useOfferName=t.USE_OFFER_NAME,this.productPreview=t.PRODUCT_PREVIEW,t.ADD_TO_BASKET_ACTION&&(this.basketAction=t.ADD_TO_BASKET_ACTION),this.showClosePopup=t.SHOW_CLOSE_POPUP,this.useCompare=t.DISPLAY_COMPARE,this.fullDisplayMode="Y"===t.PRODUCT_DISPLAY_MODE,this.bigData=t.BIG_DATA,this.viewMode=t.VIEW_MODE||"",this.templateTheme=t.TEMPLATE_THEME||"",this.useEnhancedEcommerce="Y"===t.USE_ENHANCED_ECOMMERCE,this.dataLayerName=t.DATA_LAYER_NAME,this.brandProperty=t.BRAND_PROPERTY,this.useFavorite=t.USE_FAVORITE&&void 0!==RS.Favorite,this.sliderSlideCount=parseInt(t.SLIDER_SLIDE_COUNT,10),this.useLazyImages=t.USE_LAZY_IMAGES,this.visual=t.VISUAL,this.mess=t.MESS,t.LINK_BTN_REQUEST&&(this.productRequestUrl=t.LINK_BTN_REQUEST),this.productType){case 0:case 1:case 2:case 4:t.PRODUCT&&"object"==typeof t.PRODUCT?(this.currentPriceMode=t.PRODUCT.ITEM_PRICE_MODE,this.currentPrices=t.PRODUCT.ITEM_PRICES,this.currentPriceSelected=t.PRODUCT.ITEM_PRICE_SELECTED,this.currentQuantityRanges=t.PRODUCT.ITEM_QUANTITY_RANGES,this.currentQuantityRangeSelected=t.PRODUCT.ITEM_QUANTITY_RANGE_SELECTED,this.showQuantity&&(this.product.checkQuantity=t.PRODUCT.CHECK_QUANTITY,this.product.isDblQuantity=t.PRODUCT.QUANTITY_FLOAT,this.product.checkQuantity&&(this.product.maxQuantity=this.product.isDblQuantity?parseFloat(t.PRODUCT.MAX_QUANTITY):parseInt(t.PRODUCT.MAX_QUANTITY,10)),this.product.stepQuantity=this.product.isDblQuantity?parseFloat(t.PRODUCT.STEP_QUANTITY):parseInt(t.PRODUCT.STEP_QUANTITY,10),this.checkQuantity=this.product.checkQuantity,this.isDblQuantity=this.product.isDblQuantity,this.stepQuantity=this.product.stepQuantity,this.maxQuantity=this.product.maxQuantity,this.minQuantity="Q"===this.currentPriceMode?parseFloat(this.currentPrices[this.currentPriceSelected].MIN_QUANTITY):this.stepQuantity,this.isDblQuantity&&(this.stepQuantity=Math.round(this.stepQuantity*this.precisionFactor)/this.precisionFactor)),this.product.canBuy=t.PRODUCT.CAN_BUY,t.PRODUCT.MORE_PHOTO_COUNT&&(this.product.morePhotoCount=t.PRODUCT.MORE_PHOTO_COUNT,this.product.morePhoto=t.PRODUCT.MORE_PHOTO),t.PRODUCT.RCM_ID&&(this.product.rcmId=t.PRODUCT.RCM_ID),this.canBuy=this.product.canBuy,this.product.name=t.PRODUCT.NAME,this.product.pict=t.PRODUCT.PICT,this.product.id=t.PRODUCT.ID,this.product.DETAIL_PAGE_URL=t.PRODUCT.DETAIL_PAGE_URL,t.PRODUCT.ADD_URL&&(this.product.addUrl=t.PRODUCT.ADD_URL),t.PRODUCT.BUY_URL&&(this.product.buyUrl=t.PRODUCT.BUY_URL),t.BASKET&&"object"==typeof t.BASKET&&(this.basketData.useProps=t.BASKET.ADD_PROPS,this.basketData.emptyProps=t.BASKET.EMPTY_PROPS)):this.errorCode=-1;break;case 3:t.PRODUCT&&"object"==typeof t.PRODUCT&&(this.product.name=t.PRODUCT.NAME,this.product.id=t.PRODUCT.ID,this.product.DETAIL_PAGE_URL=t.PRODUCT.DETAIL_PAGE_URL,this.product.morePhotoCount=t.PRODUCT.MORE_PHOTO_COUNT,this.product.morePhoto=t.PRODUCT.MORE_PHOTO,t.PRODUCT.RCM_ID&&(this.product.rcmId=t.PRODUCT.RCM_ID)),t.OFFERS&&BX.type.isArray(t.OFFERS)&&(this.offers=t.OFFERS,this.offerNum=0,t.OFFER_SELECTED&&(this.offerNum=parseInt(t.OFFER_SELECTED,10)),isNaN(this.offerNum)&&(this.offerNum=0),t.TREE_PROPS&&(this.treeProps=t.TREE_PROPS),t.DEFAULT_PICTURE&&(this.defaultPict.pict=t.DEFAULT_PICTURE.PICTURE,this.defaultPict.secondPict=t.DEFAULT_PICTURE.PICTURE_SECOND));break;default:this.errorCode=-1}t.BASKET&&"object"==typeof t.BASKET&&(t.BASKET.QUANTITY&&(this.basketData.quantity=t.BASKET.QUANTITY),t.BASKET.PROPS&&(this.basketData.props=t.BASKET.PROPS),t.BASKET.BASKET_URL&&(this.basketData.basketUrl=t.BASKET.BASKET_URL),3===this.productType&&t.BASKET.SKU_PROPS&&(this.basketData.sku_props=t.BASKET.SKU_PROPS),t.BASKET.ADD_URL_TEMPLATE&&(this.basketData.add_url=t.BASKET.ADD_URL_TEMPLATE),t.BASKET.BUY_URL_TEMPLATE&&(this.basketData.buy_url=t.BASKET.BUY_URL_TEMPLATE),""===this.basketData.add_url&&""===this.basketData.buy_url&&(this.errorCode=-1024)),this.useCompare&&(t.COMPARE&&"object"==typeof t.COMPARE?(t.COMPARE.COMPARE_PATH&&(this.compareData.comparePath=t.COMPARE.COMPARE_PATH),t.COMPARE.COMPARE_URL_TEMPLATE?this.compareData.compareUrl=t.COMPARE.COMPARE_URL_TEMPLATE:this.useCompare=!1,t.COMPARE.COMPARE_DELETE_URL_TEMPLATE?this.compareData.compareDeleteUrl=t.COMPARE.COMPARE_DELETE_URL_TEMPLATE:this.useCompare=!1):this.useCompare=!1),this.isFacebookConversionCustomizeProductEventEnabled=t.IS_FACEBOOK_CONVERSION_CUSTOMIZE_PRODUCT_EVENT_ENABLED}0===this.errorCode&&BX.ready(BX.delegate(this.init,this))},t.JCCatalogItem.prototype={init:function(){var t=0,i=null;if(this.obProduct=BX(this.visual.ID),this.obProduct||(this.errorCode=-1),this.obPict=BX(this.visual.PICT_ID),this.obPict||(this.errorCode=-2),this.secondPict&&this.visual.SECOND_PICT_ID&&(this.obSecondPict=BX(this.visual.SECOND_PICT_ID)),this.obPictSlider=BX(this.visual.PICT_SLIDER_ID),this.obPictSliderIndicator=BX(this.visual.PICT_SLIDER_ID+"_indicator"),this.obPrice=BX(this.visual.PRICE_ID),this.obPriceOld=BX(this.visual.PRICE_OLD_ID),this.obPriceTotal=BX(this.visual.PRICE_TOTAL_ID),this.obPriceEconomy=BX(this.visual.PRICE_ECONOMY_ID),this.obPrice||(this.errorCode=-16),this.showQuantity&&this.visual.QUANTITY_ID&&(this.obQuantity=BX(this.visual.QUANTITY_ID),this.blockNodes.quantity=this.obProduct.querySelector('[data-entity="quantity-block"]'),this.isTouchDevice||(BX.bind(this.obQuantity,"focus",BX.proxy(this.onFocus,this)),BX.bind(this.obQuantity,"blur",BX.proxy(this.onBlur,this))),this.visual.QUANTITY_UP_ID&&(this.obQuantityUp=BX(this.visual.QUANTITY_UP_ID)),this.visual.QUANTITY_DOWN_ID&&(this.obQuantityDown=BX(this.visual.QUANTITY_DOWN_ID))),this.visual.QUANTITY_LIMIT&&"N"!==this.showMaxQuantity&&(this.obQuantityLimit.all=BX(this.visual.QUANTITY_LIMIT),this.obQuantityLimit.all&&(this.obQuantityLimit.value=this.obQuantityLimit.all.querySelector('[data-entity="quantity-limit-value"]'),this.obQuantityLimit.value||(this.obQuantityLimit.all=null))),3===this.productType&&this.fullDisplayMode&&(this.visual.TREE_ID&&(this.obTree=BX(this.visual.TREE_ID),this.obTree||(this.errorCode=-256)),this.visual.QUANTITY_MEASURE&&(this.obMeasure=BX(this.visual.QUANTITY_MEASURE)),this.visual.PRODUCT_DEAL_ID&&(this.obProductDeal=BX(this.visual.PRODUCT_DEAL_ID))),this.obBasketActions=BX(this.visual.BASKET_ACTIONS_ID),this.obBasketActions&&this.visual.BUY_ID&&(this.obBuyBtn=BX(this.visual.BUY_ID)),this.obNotAvail=BX(this.visual.NOT_AVAILABLE_MESS),this.showSubscription&&(this.obSubscribe=BX(this.visual.SUBSCRIBE_ID)),this.showPercent&&(this.visual.DSC_PERC&&(this.obDscPerc=BX(this.visual.DSC_PERC)),this.secondPict&&this.visual.SECOND_DSC_PERC&&(this.obSecondDscPerc=BX(this.visual.SECOND_DSC_PERC))),this.showSkuProps&&this.visual.DISPLAY_PROP_DIV&&(this.obSkuProps=BX(this.visual.DISPLAY_PROP_DIV)),this.useOfferName&&(this.obName=BX(this.visual.NAME)),this.visual.ACTION_REQUEST_LINK&&(this.obProductRequestBtn=BX(this.visual.ACTION_REQUEST_LINK)),this.isTouchDevice||(BX.bind(this.obProduct,"mouseenter",BX.proxy(this.hoverOn,this)),BX.bind(this.obProduct,"mouseleave",BX.proxy(this.hoverOff,this))),0===this.errorCode){if(this.isTouchDevice&&(BX.bind(this.obPictSlider,"touchstart",BX.proxy(this.touchStartEvent,this)),BX.bind(this.obPictSlider,"touchend",BX.proxy(this.touchEndEvent,this)),BX.bind(this.obPictSlider,"touchcancel",BX.proxy(this.touchEndEvent,this))),this.bigData){var s=BX.findChildren(this.obProduct,{tag:"a"},!0);if(s)for(t in s)s.hasOwnProperty(t)&&s[t].getAttribute("href")==this.product.DETAIL_PAGE_URL&&BX.bind(s[t],"click",BX.proxy(this.rememberProductRecommendation,this))}if(this.showQuantity){var e=this.isTouchDevice?"touchstart":"mousedown",a=this.isTouchDevice?"touchend":"mouseup";this.obQuantityUp&&(BX.bind(this.obQuantityUp,e,BX.proxy(this.startQuantityInterval,this)),BX.bind(this.obQuantityUp,a,BX.proxy(this.clearQuantityInterval,this)),BX.bind(this.obQuantityUp,"mouseout",BX.proxy(this.clearQuantityInterval,this)),BX.bind(this.obQuantityUp,"click",BX.delegate(this.quantityUp,this))),this.obQuantityDown&&(BX.bind(this.obQuantityDown,e,BX.proxy(this.startQuantityInterval,this)),BX.bind(this.obQuantityDown,a,BX.proxy(this.clearQuantityInterval,this)),BX.bind(this.obQuantityDown,"mouseout",BX.proxy(this.clearQuantityInterval,this)),BX.bind(this.obQuantityDown,"click",BX.delegate(this.quantityDown,this))),this.obQuantity&&BX.bind(this.obQuantity,"change",BX.delegate(this.quantityChange,this))}switch(this.productType){case 0:case 1:case 2:case 4:parseInt(this.product.morePhotoCount)>1&&this.obPictSlider&&this.initializeSlider(),this.checkQuantityControls();break;case 3:if(this.offers.length>0){if((i=BX.findChildren(this.obTree,{tagName:"li"},!0))&&i.length)for(t=0;t<i.length;t++)BX.bind(i[t],"click",BX.delegate(this.selectOfferProp,this));this.setCurrent()}else parseInt(this.product.morePhotoCount)>1&&this.obPictSlider&&this.initializeSlider()}this.obBuyBtn&&("ADD"===this.basketAction?BX.bind(this.obBuyBtn,"click",BX.proxy(this.add2Basket,this)):BX.bind(this.obBuyBtn,"click",BX.proxy(this.buyBasket,this))),this.obBasketActions&&(0==this.productType?(BX.addCustomEvent("add2basket.rs_lightbasket",function(){this.setCartStatus()}.bind(this)),BX.addCustomEvent("clear.rs_lightbasket",function(){this.setCartStatus()}.bind(this)),BX.addCustomEvent("delete.rs_lightbasket",function(){this.setCartStatus()}.bind(this))):BX.addCustomEvent("OnBasketChange",function(){this.setCartStatus()}.bind(this))),this.useCompare&&(this.obCompare=BX(this.visual.COMPARE_LINK_ID),this.obCompare&&BX.bind(this.obCompare,"click",BX.proxy(this.compare,this)),BX.addCustomEvent("onCatalogDeleteCompare",BX.proxy(this.checkDeletedCompare,this)),BX.addCustomEvent("onCompareChange",BX.proxy(this.checkCompare,this))),this.useFavorite&&(this.obFavorite=BX(this.visual.FAVORITE_ID),this.obFavorite&&(BX.bind(this.obFavorite,"click",BX.proxy(this.favorite,this)),BX.addCustomEvent("change.rs_favorite",BX.proxy(this.checkFavorite,this)),this.checkFavorite())),this.productPreview&&(this.obPreview=this.obProduct.querySelector('[data-entity="preview"]'),this.obPreview&&BX.bind(this.obPreview,"click",BX.proxy(this.showProductPreview,this))),this.setCartStatus()}},setAnalyticsDataLayer:function(i){if(this.useEnhancedEcommerce&&this.dataLayerName){var s,e,a,r,o,h,n={},u={},c=[];switch(this.productType){case 0:case 1:case 2:case 4:n={id:this.product.id,name:this.product.name,price:this.currentPrices[this.currentPriceSelected]&&this.currentPrices[this.currentPriceSelected].PRICE,brand:BX.type.isArray(this.brandProperty)?this.brandProperty.join("/"):this.brandProperty};break;case 3:for(s in this.offers[this.offerNum].TREE)if(this.offers[this.offerNum].TREE.hasOwnProperty(s))for(e in r=s.substring(5),o=this.offers[this.offerNum].TREE[s],this.treeProps)if(this.treeProps.hasOwnProperty(e)&&this.treeProps[e].ID==r)for(a in this.treeProps[e].VALUES)if((h=this.treeProps[e].VALUES[a]).ID==o){c.push(h.NAME);break}n={id:this.offers[this.offerNum].ID,name:this.offers[this.offerNum].NAME,price:this.currentPrices[this.currentPriceSelected]&&this.currentPrices[this.currentPriceSelected].PRICE,brand:BX.type.isArray(this.brandProperty)?this.brandProperty.join("/"):this.brandProperty,variant:c.join("/")}}switch(i){case"addToCart":u={event:"addToCart",ecommerce:{currencyCode:this.currentPrices[this.currentPriceSelected]&&this.currentPrices[this.currentPriceSelected].CURRENCY||"",add:{products:[{name:n.name||"",id:n.id||"",price:n.price||0,brand:n.brand||"",category:n.category||"",variant:n.variant||"",quantity:this.showQuantity&&this.obQuantity?this.obQuantity.value:1}]}}}}t[this.dataLayerName]=t[this.dataLayerName]||[],t[this.dataLayerName].push(u)}},hoverOn:function(t){clearTimeout(this.hoverTimer),this.obProduct.style.height=getComputedStyle(this.obProduct).height,BX.addClass(this.obProduct,"hover"),BX.PreventDefault(t)},hoverOff:function(t){this.hoverStateChangeForbidden||(BX.removeClass(this.obProduct,"hover"),this.hoverTimer=setTimeout(BX.delegate(function(){this.obProduct.style.height=""},this),300),BX.PreventDefault(t))},onFocus:function(){this.hoverStateChangeForbidden=!0,BX.bind(document,"mousemove",BX.proxy(this.captureMousePosition,this))},onBlur:function(){this.hoverStateChangeForbidden=!1,BX.unbind(document,"mousemove",BX.proxy(this.captureMousePosition,this));var t=document.elementFromPoint(this.mouseX,this.mouseY);t&&this.obProduct.contains(t)||this.hoverOff()},captureMousePosition:function(t){this.mouseX=t.clientX,this.mouseY=t.clientY},getCookie:function(t){var i=document.cookie.match(new RegExp("(?:^|; )"+t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return i?decodeURIComponent(i[1]):null},rememberProductRecommendation:function(){var t,i=BX.cookie_prefix+"_RCM_PRODUCT_LOG",s=this.getCookie(i),e=!1,a=[];s&&(a=s.split("."));for(var r=a.length;r--;)(t=a[r].split("-"))[0]==this.product.id?((t=a[r].split("-"))[1]=this.product.rcmId,t[2]=BX.current_server_time,a[r]=t.join("-"),e=!0):BX.current_server_time-t[2]>2592e3&&a.splice(r,1);e||a.push([this.product.id,this.product.rcmId,BX.current_server_time].join("-"));var o=a.join("."),h=new Date((new Date).getTime()+31536e7).toUTCString();document.cookie=i+"="+o+"; path=/; expires="+h+"; domain="+BX.cookie_domain},startQuantityInterval:function(){var t=BX.proxy_context.id===this.visual.QUANTITY_DOWN_ID?BX.proxy(this.quantityDown,this):BX.proxy(this.quantityUp,this);this.quantityDelay=setTimeout(BX.delegate(function(){this.quantityTimer=setInterval(t,150)},this),300)},clearQuantityInterval:function(){clearTimeout(this.quantityDelay),clearInterval(this.quantityTimer)},quantityUp:function(){var t=0,i=!0;0===this.errorCode&&this.showQuantity&&this.canBuy&&(t=this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10),isNaN(t)||(t+=this.stepQuantity,this.checkQuantity&&t>this.maxQuantity&&(i=!1),i&&(this.isDblQuantity&&(t=Math.round(t*this.precisionFactor)/this.precisionFactor),this.obQuantity.value=t,this.setPrice())))},quantityDown:function(){var t=0,i=!0;0===this.errorCode&&this.showQuantity&&this.canBuy&&(t=this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10),isNaN(t)||(t-=this.stepQuantity,this.checkPriceRange(t),t<this.minQuantity&&(i=!1),i&&(this.isDblQuantity&&(t=Math.round(t*this.precisionFactor)/this.precisionFactor),this.obQuantity.value=t,this.setPrice())))},quantityChange:function(){var t,i=0;0===this.errorCode&&this.showQuantity&&(this.canBuy?(i=this.isDblQuantity?parseFloat(this.obQuantity.value):Math.round(this.obQuantity.value),isNaN(i)?this.obQuantity.value=this.minQuantity:(this.checkQuantity&&i>this.maxQuantity&&(i=this.maxQuantity),this.checkPriceRange(i),i<this.minQuantity?i=this.minQuantity:(i=(t=Math.round(Math.round(i*this.precisionFactor/this.stepQuantity)/this.precisionFactor)||1)<=1?this.stepQuantity:t*this.stepQuantity,i=Math.round(i*this.precisionFactor)/this.precisionFactor),this.obQuantity.value=i)):this.obQuantity.value=this.minQuantity,this.setPrice())},quantitySet:function(t){var i,s,e=this.offers[t],a=this.offers[this.offerNum];if(0===this.errorCode){if(this.canBuy=e.CAN_BUY,this.currentPriceMode=e.ITEM_PRICE_MODE,this.currentPrices=e.ITEM_PRICES,this.currentPriceSelected=e.ITEM_PRICE_SELECTED,this.currentQuantityRanges=e.ITEM_QUANTITY_RANGES,this.currentQuantityRangeSelected=e.ITEM_QUANTITY_RANGE_SELECTED,this.canBuy?(this.blockNodes.quantity&&BX.style(this.blockNodes.quantity,"display",""),this.obBasketActions&&BX.style(this.obBasketActions,"display",""),this.obSubscribe&&BX.style(this.obSubscribe,"display","none")):(this.blockNodes.quantity&&BX.style(this.blockNodes.quantity,"display","none"),this.obBasketActions&&BX.style(this.obBasketActions,"display","none"),this.obSubscribe&&("Y"===e.CATALOG_SUBSCRIBE?(BX.style(this.obSubscribe,"display",""),this.obSubscribe.setAttribute("data-item",e.ID),BX(this.visual.SUBSCRIBE_ID+"_hidden").click()):BX.style(this.obSubscribe,"display","none"))),this.isDblQuantity=e.QUANTITY_FLOAT,this.checkQuantity=e.CHECK_QUANTITY,this.isDblQuantity?(this.stepQuantity=Math.round(parseFloat(e.STEP_QUANTITY)*this.precisionFactor)/this.precisionFactor,this.maxQuantity=parseFloat(e.MAX_QUANTITY),this.minQuantity="Q"===this.currentPriceMode?parseFloat(this.currentPrices[this.currentPriceSelected].MIN_QUANTITY):this.stepQuantity):(this.stepQuantity=parseInt(e.STEP_QUANTITY,10),this.maxQuantity=parseInt(e.MAX_QUANTITY,10),this.minQuantity="Q"===this.currentPriceMode?parseInt(this.currentPrices[this.currentPriceSelected].MIN_QUANTITY):this.stepQuantity),this.checkQuantity&&0==this.maxQuantity?this.obNotAvail&&BX.style(this.obNotAvail,"display",""):this.canBuy||this.obNotAvail&&BX.style(this.obNotAvail,"display","none"),this.showQuantity){var r=a.ITEM_PRICES.length&&a.ITEM_PRICES[a.ITEM_PRICE_SELECTED]&&a.ITEM_PRICES[a.ITEM_PRICE_SELECTED].MIN_QUANTITY!=this.minQuantity;i=this.isDblQuantity?Math.round(parseFloat(a.STEP_QUANTITY)*this.precisionFactor)/this.precisionFactor!==this.stepQuantity||r||a.MEASURE!==e.MEASURE||this.checkQuantity&&parseFloat(a.MAX_QUANTITY)>this.maxQuantity&&parseFloat(this.obQuantity.value)>this.maxQuantity:parseInt(a.STEP_QUANTITY,10)!==this.stepQuantity||r||a.MEASURE!==e.MEASURE||this.checkQuantity&&parseInt(a.MAX_QUANTITY,10)>this.maxQuantity&&parseInt(this.obQuantity.value,10)>this.maxQuantity,this.obQuantity.disabled=!this.canBuy,i&&(this.obQuantity.value=this.minQuantity),this.obMeasure&&(e.MEASURE?BX.adjust(this.obMeasure,{html:e.MEASURE}):BX.adjust(this.obMeasure,{html:""}))}this.obQuantityLimit.all&&(this.checkQuantity&&0!=this.maxQuantity?("M"===this.showMaxQuantity?s=this.maxQuantity/this.stepQuantity>=this.relativeQuantityFactor?BX.message("RELATIVE_QUANTITY_MANY"):BX.message("RELATIVE_QUANTITY_FEW"):(s=this.maxQuantity,e.MEASURE&&(s+=" "+e.MEASURE)),BX.adjust(this.obQuantityLimit.value,{html:s}),BX.adjust(this.obQuantityLimit.all,{attrs:{className:this.maxQuantity/this.stepQuantity>=this.relativeQuantityFactor?"product-cat-limit is-instock":"product-cat-limit is-limited"},style:{display:""}})):(BX.adjust(this.obQuantityLimit.value,{html:""}),BX.adjust(this.obQuantityLimit.all,{style:{display:"none"}})))}},initializeSlider:function(){if(this.slider.items=BX.findChildren(this.obPictSlider,{className:"item"},!0),this.isTouchDevice)this.slider.options.interval=!1;else if(this.slider.options.interval=parseInt(this.obPictSlider.getAttribute("data-slider-interval"))||this.defaultSliderOptions.interval,this.slider.options.interval<700&&(this.slider.options.interval=700),this.obPictSliderIndicator){var t=this.obPictSliderIndicator.querySelectorAll("[data-go-to]");for(var i in t)t.hasOwnProperty(i)&&(BX.bind(t[i],"mouseenter",BX.proxy(this.sliderHoverOnHandler,this)),BX.bind(t[i],"mouseleave",BX.proxy(this.sliderHoverOffHandler,this)))}},checkTouch:function(t){return!(!t||!t.changedTouches)&&t.changedTouches[0].identifier===this.touch.identifier},touchStartEvent:function(t){1==t.touches.length&&(this.touch=t.changedTouches[0])},touchEndEvent:function(t){if(this.checkTouch(t)){var i=this.touch.pageX-t.changedTouches[0].pageX,s=this.touch.pageY-t.changedTouches[0].pageY;Math.abs(i)>=Math.abs(s)+10&&(i>0&&this.slideNext(),i<0&&this.slidePrev())}},sliderHoverOnHandler:function(t){var i=BX.proxy_context.getAttribute("data-go-to");this.slideShow(i),BX.PreventDefault(t)},sliderHoverOffHandler:function(t){this.slideShow(0)},slideShow:function(t){var i=this.obPictSlider.querySelectorAll("img"),s=this.obPictSliderIndicator.querySelectorAll("[data-go-to]");for(var e in s)s.hasOwnProperty(e)&&BX.removeClass(s[e],"active");for(var e in s[this.getItemIndex(this.eq(this.slider.items,t))]&&BX.addClass(s[this.getItemIndex(this.eq(this.slider.items,t))],"active"),i)i.hasOwnProperty(e)&&BX.removeClass(i[e].parentNode,"active");i[this.getItemIndex(this.eq(this.slider.items,t))]&&BX.addClass(i[this.getItemIndex(this.eq(this.slider.items,t))].parentNode,"active")},slideNext:function(){if(!this.slider.sliding)return this.slide("next")},slidePrev:function(){if(!this.slider.sliding)return this.slide("prev")},slide:function(t,i){var s=BX.findChild(this.obPictSlider,{className:"item active"},!0,!1),e=this.slider.interval,a="next"===t?"left":"right";if(i=i||this.getItemForDirection(t,s),BX.hasClass(i,"active"))return this.slider.sliding=!1;if(this.slider.sliding=!0,e&&this.stopSlider(),this.obPictSliderIndicator){BX.removeClass(this.obPictSliderIndicator.querySelector(".active"),"active");var r=this.obPictSliderIndicator.querySelectorAll("[data-go-to]")[this.getItemIndex(i)];r&&BX.addClass(r,"active")}if(BX.hasClass(this.obPictSlider,"slide")&&!BX.browser.IsIE()){var o=this;BX.addClass(i,t),i.offsetWidth,BX.addClass(s,a),BX.addClass(i,a),setTimeout(function(){BX.addClass(i,"active"),BX.removeClass(s,"active"),BX.removeClass(s,a),BX.removeClass(i,t),BX.removeClass(i,a),o.slider.sliding=!1},700)}else BX.addClass(i,"active"),this.slider.sliding=!1;this.obPictSliderProgressBar&&this.resetProgress(),e&&this.cycleSlider()},stopSlider:function(t){if(t||(this.slider.paused=!0),this.slider.interval&&clearInterval(this.slider.interval),this.slider.progress){this.slider.progress.stop();var i=parseInt(this.obPictSliderProgressBar.style.width);this.slider.progress.options.duration=this.slider.options.interval*i/200,this.slider.progress.options.start={width:10*i},this.slider.progress.options.finish={width:0},this.slider.progress.options.complete=null,this.slider.progress.animate()}},cycleSlider:function(t){if(t||(this.slider.paused=!1),this.slider.interval&&clearInterval(this.slider.interval),this.slider.options.interval&&!this.slider.paused)if(this.slider.progress){this.slider.progress.stop();var i=parseInt(this.obPictSliderProgressBar.style.width);this.slider.progress.options.duration=this.slider.options.interval*(100-i)/100,this.slider.progress.options.start={width:10*i},this.slider.progress.options.finish={width:1e3},this.slider.progress.options.complete=BX.delegate(function(){this.slider.interval=!0,this.slideNext()},this),this.slider.progress.animate()}else this.slider.interval=setInterval(BX.proxy(this.slideNext,this),this.slider.options.interval)},resetProgress:function(){this.slider.progress&&this.slider.progress.stop(),this.obPictSliderProgressBar.style.width=0},getItemForDirection:function(t,i){var s=this.getItemIndex(i);if(("prev"===t&&0===s||"next"===t&&s==this.slider.items.length-1)&&!this.slider.options.wrap)return i;var e=(s+("prev"===t?-1:1))%this.slider.items.length;return this.eq(this.slider.items,e)},getItemIndex:function(t){return this.slider.items=BX.findChildren(t.parentNode,{className:"item"},!0),this.slider.items.indexOf(t||this.slider.active)},eq:function(t,i){var s=t.length,e=+i+(i<0?s:0);return e>=0&&e<s?t[e]:{}},selectOfferProp:function(){var t=0,i=[],s=null,e=BX.proxy_context;if(e&&e.hasAttribute("data-treevalue")){if(BX.hasClass(e,"checked"))return;if(i=e.getAttribute("data-treevalue").split("_"),this.searchOfferPropIndex(i[0],i[1])){if((s=BX.findChildren(e.parentNode,{tagName:"li"},!1))&&0<s.length)for(t=0;t<s.length;t++)s[t].getAttribute("data-onevalue")===i[1]?BX.addClass(s[t],"checked"):BX.removeClass(s[t],"checked");this.isFacebookConversionCustomizeProductEventEnabled&&BX.Type.isArrayFilled(this.offers)&&BX.Type.isObject(this.offers[this.offerNum])&&BX.ajax.runAction("sale.facebookconversion.customizeProduct",{data:{offerId:this.offers[this.offerNum].ID}}),this.setOfferCurrentValue(BX.findParent(e,{attribute:{"data-entity":"sku-line-block"}}),e)}}},searchOfferPropIndex:function(t,i){var s,e,a="",r=!1,o=[],h=[],n=-1,u={},c=[];for(s=0;s<this.treeProps.length;s++)if(this.treeProps[s].ID===t){n=s;break}if(-1<n){for(s=0;s<n;s++)u[a="PROP_"+this.treeProps[s].ID]=this.selectedValues[a];if(a="PROP_"+this.treeProps[n].ID,!(r=this.getRowValues(u,a)))return!1;if(!BX.util.in_array(i,r))return!1;for(u[a]=i,s=n+1;s<this.treeProps.length;s++){if(a="PROP_"+this.treeProps[s].ID,!(r=this.getRowValues(u,a)))return!1;if(h=[],this.showAbsent)for(o=[],c=[],c=BX.clone(u,!0),e=0;e<r.length;e++)c[a]=r[e],h[h.length]=r[e],this.getCanBuy(c)&&(o[o.length]=r[e]);else o=r;this.selectedValues[a]&&BX.util.in_array(this.selectedValues[a],o)?u[a]=this.selectedValues[a]:this.showAbsent?u[a]=o.length>0?o[0]:h[0]:u[a]=o[0],this.updateRow(s,u[a],r,o)}this.selectedValues=u,this.changeInfo()}return!0},updateRow:function(t,i,s,e){var a,r=0,o="",h=!1,n=null,u=this.obTree.querySelectorAll('[data-entity="sku-line-block"]');if(t>-1&&t<u.length&&(a=u[t].querySelector("ul"),(n=BX.findChildren(a,{tagName:"li"},!1))&&0<n.length)){var c;for(r=0;r<n.length;r++)(h=(o=n[r].getAttribute("data-onevalue"))===i)?BX.addClass(n[r],"checked"):BX.removeClass(n[r],"checked"),BX.util.in_array(o,e)?BX.removeClass(n[r],"disabled"):BX.addClass(n[r],"disabled"),BX.removeClass(n[r],"last-visible"),BX.util.in_array(o,s)?(c=n[r],n[r].style.display=""):n[r].style.display="none",h&&(u[t].style.display=0==o&&1==e.length?"none":"",this.setOfferCurrentValue(u[t],n[r]));c&&BX.addClass(c,"last-visible")}},getRowValues:function(t,i){var s,e=0,a=[],r=!1,o=!0;if(0===t.length){for(e=0;e<this.offers.length;e++)BX.util.in_array(this.offers[e].TREE[i],a)||(a[a.length]=this.offers[e].TREE[i]);r=!0}else for(e=0;e<this.offers.length;e++){for(s in o=!0,t)if(t[s]!==this.offers[e].TREE[s]){o=!1;break}o&&(BX.util.in_array(this.offers[e].TREE[i],a)||(a[a.length]=this.offers[e].TREE[i]),r=!0)}return!!r&&a},getCanBuy:function(t){var i,s,e=!1,a=!0;for(i=0;i<this.offers.length;i++){for(s in a=!0,t)if(t[s]!==this.offers[i].TREE[s]){a=!1;break}if(a&&this.offers[i].CAN_BUY){e=!0;break}}return e},setCurrent:function(){var t,i=0,s=[],e="",a=!1,r={},o=[],h=this.offers[this.offerNum].TREE;for(t=0;t<this.treeProps.length&&(e="PROP_"+this.treeProps[t].ID,a=this.getRowValues(r,e));t++){if(BX.util.in_array(h[e],a)?r[e]=h[e]:(r[e]=a[0],this.offerNum=0),this.showAbsent)for(s=[],o=[],o=BX.clone(r,!0),i=0;i<a.length;i++)o[e]=a[i],this.getCanBuy(o)&&(s[s.length]=a[i]);else s=a;this.updateRow(t,r[e],a,s)}this.selectedValues=r,this.changeInfo()},changeInfo:function(){var t,i,s,e=-1,a=!0;for(t=0;t<this.offers.length;t++){for(i in a=!0,this.selectedValues)if(this.selectedValues[i]!==this.offers[t].TREE[i]){a=!1;break}if(a){e=t;break}}if(e>-1){if(parseInt(this.offers[e].MORE_PHOTO_COUNT)>1&&this.obPictSlider){for(t in this.obPict&&(this.obPict.style.display="none"),BX.cleanNode(this.obPictSlider),this.offers[e].MORE_PHOTO)if(this.offers[e].MORE_PHOTO.hasOwnProperty(t)){s=BX.create("IMG",{props:{className:"product-cat-image"},attrs:{src:this.offers[e].MORE_PHOTO[t].SRC,width:this.offers[e].MORE_PHOTO[t].WIDTH,height:this.offers[e].MORE_PHOTO[t].HEIGHT,alt:this.offers[e].NAME,title:this.offers[e].NAME}}),this.useLazyImages&&s.setAttribute("loading","lazy");var r=BX.create("span",{props:{className:"product-cat-image-slide item"+(0==t?" active":"")},children:[s]});if(this.obPictSlider.appendChild(r),t>this.sliderSlideCount-2&&this.offers[e].MORE_PHOTO_COUNT>this.sliderSlideCount){var o=BX.message("SLIDER_MORE_MESSAGE");o=o.replace("#NUMBER#",this.offers[e].MORE_PHOTO_COUNT-this.sliderSlideCount),r.appendChild(BX.create("span",{props:{className:"product-cat-image-slider-more"},children:[BX.create("span",{props:{className:"product-cat-image-slider-more-wrapper"},children:[BX.create("span",{props:{className:"product-cat-image-slider-more-icon"},html:'<svg class="icon-svg"><use xlink:href="#svg-camera"></use></svg>'}),BX.create("span",{props:{className:"product-cat-image-slider-more-text"},text:o})]})]}));break}}if(this.obPictSliderIndicator){for(t in BX.cleanNode(this.obPictSliderIndicator),this.offers[e].MORE_PHOTO)if(this.offers[e].MORE_PHOTO.hasOwnProperty(t)&&(this.obPictSliderIndicator.appendChild(BX.create("span",{attrs:{"data-go-to":t},props:{className:"product-cat-image-slider-control"+(0==t?" active":"")}})),t>=this.sliderSlideCount-1))break;this.obPictSliderIndicator.style.display=""}this.obPictSlider.style.display="",this.initializeSlider()}else this.obPictSlider&&(this.obPictSlider.style.display="none"),this.obPict&&(this.offers[e].PREVIEW_PICTURE?BX.adjust(this.obPict,{attrs:{src:this.offers[e].PREVIEW_PICTURE.SRC}}):BX.adjust(this.obPict,{attrs:{src:this.defaultPict.pict.SRC}}),this.obPict.style.display="");this.showSkuProps&&this.obSkuProps&&(this.offers[e].DISPLAY_PROPERTIES.length?BX.adjust(this.obSkuProps,{style:{display:""},html:this.offers[e].DISPLAY_PROPERTIES}):BX.adjust(this.obSkuProps,{style:{display:"none"},html:""})),this.obProductRequestBtn&&this.obProductRequestBtn.setAttribute("href",this.config.productRequestUrl.replace("#ELEMENT_ID#",this.offers[e].ID)),this.useOfferName&&this.obName&&(this.obName.innerHTML=BX.Text.encode(this.offers[e].NAME)),this.quantitySet(e),this.setPrice(),this.setCompared(this.offers[e].COMPARED),this.setProductDeal(e),this.offerNum=e,this.setCartStatus()}},checkPriceRange:function(t){if(void 0!==t&&"Q"==this.currentPriceMode){var i,s=!1;for(var e in this.currentQuantityRanges)if(this.currentQuantityRanges.hasOwnProperty(e)&&(i=this.currentQuantityRanges[e],parseInt(t)>=parseInt(i.SORT_FROM)&&("INF"==i.SORT_TO||parseInt(t)<=parseInt(i.SORT_TO)))){s=!0,this.currentQuantityRangeSelected=i.HASH;break}for(var a in!s&&(i=this.getMinPriceRange())&&(this.currentQuantityRangeSelected=i.HASH),this.currentPrices)if(this.currentPrices.hasOwnProperty(a)&&this.currentPrices[a].QUANTITY_HASH==this.currentQuantityRangeSelected){this.currentPriceSelected=a;break}}},getMinPriceRange:function(){var t;for(var i in this.currentQuantityRanges)this.currentQuantityRanges.hasOwnProperty(i)&&(!t||parseInt(this.currentQuantityRanges[i].SORT_FROM)<parseInt(t.SORT_FROM))&&(t=this.currentQuantityRanges[i]);return t},checkQuantityControls:function(){if(this.obQuantity){var t=this.checkQuantity&&parseFloat(this.obQuantity.value)+this.stepQuantity>this.maxQuantity,i=parseFloat(this.obQuantity.value)-this.stepQuantity<this.minQuantity;t?BX.addClass(this.obQuantityUp,"product-item-amount-field-btn-disabled"):BX.hasClass(this.obQuantityUp,"product-item-amount-field-btn-disabled")&&BX.removeClass(this.obQuantityUp,"product-item-amount-field-btn-disabled"),i?BX.addClass(this.obQuantityDown,"product-item-amount-field-btn-disabled"):BX.hasClass(this.obQuantityDown,"product-item-amount-field-btn-disabled")&&BX.removeClass(this.obQuantityDown,"product-item-amount-field-btn-disabled"),t&&i?this.obQuantity.setAttribute("disabled","disabled"):this.obQuantity.removeAttribute("disabled")}},setPrice:function(){var t,i,s="";this.obQuantity&&this.checkPriceRange(this.obQuantity.value),this.checkQuantityControls(),i=this.currentPrices[this.currentPriceSelected],this.obPrice&&(i?BX.adjust(this.obPrice,{html:BX.Currency?BX.Currency.currencyFormat(i.RATIO_PRICE,i.CURRENCY,!0):i.PRINT_RATIO_PRICE}):BX.adjust(this.obPrice,{html:""}),this.showOldPrice&&this.obPriceOld&&(i&&i.RATIO_PRICE!==i.RATIO_BASE_PRICE?BX.adjust(this.obPriceOld,{html:BX.Currency?BX.Currency.currencyFormat(i.RATIO_BASE_PRICE,i.CURRENCY,!0):i.PRINT_RATIO_BASE_PRICE}):BX.adjust(this.obPriceOld,{html:""})),this.showOldPrice&&this.obPriceEconomy&&(i&&i.RATIO_PRICE!==i.RATIO_BASE_PRICE?(s=(s=BX.message("ECONOMY_INFO_MESSAGE")).replace("#ECONOMY#",0==this.productType?i.PRINT_RATIO_DISCOUNT:BX.Currency.currencyFormat(i.RATIO_DISCOUNT,i.CURRENCY,!0)),BX.adjust(this.obPriceEconomy,{style:{display:""},html:s})):this.obPriceEconomy&&BX.adjust(this.obPriceEconomy,{html:""})),this.obPriceTotal&&(i&&this.obQuantity&&this.obQuantity.value!=this.stepQuantity?BX.adjust(this.obPriceTotal,{html:BX.message("PRICE_TOTAL_PREFIX")+": "+(BX.Currency?BX.Currency.currencyFormat(i.PRICE*this.obQuantity.value,i.CURRENCY,!0):i.PRICE*this.obQuantity.value+""+i.CURRENCY),style:{display:""}}):BX.adjust(this.obPriceTotal,{html:"",style:{display:"none"}})),this.showPercent&&(t=i&&parseInt(i.DISCOUNT)>0?{style:{display:""},html:-i.PERCENT+"%"}:{style:{display:"none"},html:""},this.obDscPerc&&BX.adjust(this.obDscPerc,t),this.obSecondDscPerc&&BX.adjust(this.obSecondDscPerc,t)))},compare:function(t){var i=this.obCompare.querySelector('[data-entity="compare-checkbox"]'),s=BX.getEventTarget(t),e=!0;i&&(e=s===i?i.checked:!i.checked);var a,r=e?this.compareData.compareUrl:this.compareData.compareDeleteUrl;if(r){switch(s!==i&&(BX.PreventDefault(t),this.setCompared(e)),this.productType){case 0:case 1:case 2:case 4:a=r.replace("#ID#",this.product.id.toString());break;case 3:a=r.replace("#ID#",this.offers[this.offerNum].ID)}BX.ajax({method:"POST",dataType:e?"json":"html",url:a+(-1!==a.indexOf("?")?"&":"?")+"ajax_action=Y",onsuccess:e?BX.proxy(this.compareResult,this):BX.proxy(this.compareDeleteResult,this)})}},compareResult:function(t){var s,e;BX.type.isPlainObject(t)&&(this.offers.length>0&&(this.offers[this.offerNum].COMPARED="OK"===t.STATUS),"OK"===t.STATUS?BX.onCustomEvent("OnCompareChange",[{action:"add",id:t.ID}]):(this.initPopupWindow(),s='<div class="alert alert-danger">'+(t.MESSAGE?t.MESSAGE:BX.message("COMPARE_UNKNOWN_ERROR"))+"</div>",e=[new i({text:BX.message("BTN_MESSAGE_CLOSE"),events:{click:BX.delegate(this.obPopupWin.close,this.obPopupWin)}})],this.obPopupWin.setTitleBar(BX.message("COMPARE_TITLE")),this.obPopupWin.setContent(s),this.obPopupWin.setButtons(e),this.obPopupWin.show()))},compareDeleteResult:function(t){"OK"===(t=BX.parseJSON(t)).STATUS&&BX.onCustomEvent("OnCompareChange",[{action:"delete",id:t.ID}]),this.offers&&this.offers.length&&(this.offers[this.offerNum].COMPARED=!1)},checkCompare:function(t){if(null!=t)switch(this.productType){case 0:case 1:case 2:case 4:this.product.id==t.id&&this.setCompared("add"==t.action);break;case 3:for(var i=this.offers.length;i--;)if(this.offers[i].ID==t.id){this.offers[i].COMPARED=!1,this.offerNum==i&&this.setCompared("add"==t.action);break}}},setCompared:function(t){if(this.obCompare){t?BX.addClass(this.obCompare,"checked"):BX.removeClass(this.obCompare,"checked");var i=this.obCompare.querySelector('[data-entity="compare-checkbox"]');i&&(i.checked=t);var s=this.obCompare.querySelector('[data-entity="compare-title"]');s&&(s.innerHTML=t?BX.message("BTN_COMPARE_DEL"):BX.message("BTN_COMPARE_ADD"))}},setCompareInfo:function(t){if(BX.type.isArray(t))for(var i in this.offers)this.offers.hasOwnProperty(i)&&(this.offers[i].COMPARED=BX.util.in_array(this.offers[i].ID,t))},compareRedirect:function(){this.compareData.comparePath?location.href=this.compareData.comparePath:this.obPopupWin.close()},checkDeletedCompare:function(t){switch(this.productType){case 0:case 1:case 2:case 4:this.product.id==t&&this.setCompared(!1);break;case 3:for(var i=this.offers.length;i--;)if(this.offers[i].ID==t){this.offers[i].COMPARED=!1,this.offerNum==i&&this.setCompared(!1);break}}},initBasketUrl:function(){switch(this.basketUrl="ADD"===this.basketMode?this.basketData.add_url:this.basketData.buy_url,this.productType){case 1:case 2:case 4:this.basketUrl=this.basketUrl.replace("#ID#",this.product.id.toString());break;case 3:this.basketUrl=this.basketUrl.replace("#ID#",this.offers[this.offerNum].ID)}this.basketParams={ajax_basket:"Y"},this.showQuantity&&(this.basketParams[this.basketData.quantity]=this.obQuantity.value),this.basketData.sku_props&&(this.basketParams[this.basketData.sku_props_var]=this.basketData.sku_props)},fillBasketProps:function(){if(this.visual.BASKET_PROP_DIV){var t=0,i=null,s=!1,e=null;if(this.basketData.useProps&&!this.basketData.emptyProps?this.obPopupWin&&this.obPopupWin.contentContainer&&(e=this.obPopupWin.contentContainer):e=BX(this.visual.BASKET_PROP_DIV),e){if((i=e.getElementsByTagName("select"))&&i.length)for(t=0;t<i.length;t++)if(!i[t].disabled)switch(i[t].type.toLowerCase()){case"select-one":this.basketParams[i[t].name]=i[t].value,s=!0}if((i=e.getElementsByTagName("input"))&&i.length)for(t=0;t<i.length;t++)if(!i[t].disabled)switch(i[t].type.toLowerCase()){case"hidden":this.basketParams[i[t].name]=i[t].value,s=!0;break;case"radio":i[t].checked&&(this.basketParams[i[t].name]=i[t].value,s=!0)}}s||(this.basketParams[this.basketData.props]=[],this.basketParams[this.basketData.props][0]=0)}},add2Basket:function(){this.basketMode="ADD",this.basket()},buyBasket:function(){this.basketMode="BUY",this.basket()},sendToBasket:function(){if(this.canBuy)switch(this.product&&this.product.id&&this.bigData&&this.rememberProductRecommendation(),this.productType){case 0:this.showQuantity?Basket.add(this.product.id,this.obQuantity.value):Basket.add(this.product.id,1),this.basketResult({STATUS:"OK"});break;case 1:case 2:case 3:case 4:this.initBasketUrl(),this.fillBasketProps(),BX.ajax({method:"POST",dataType:"json",url:this.basketUrl,data:this.basketParams,onsuccess:BX.proxy(this.basketResult,this)})}},basket:function(){if(this.obBasketActions&&null!=t.Basket){var s=Basket.inbasket();switch(this.productType){case 3:if(BX.util.in_array(this.offers[this.offerNum].ID+"",s))return void this.basketRedirect();break;default:if(BX.util.in_array(this.product.id+"",s))return void this.basketRedirect()}}var e="";if(this.canBuy)switch(this.productType){case 1:case 2:case 4:this.basketData.useProps&&!this.basketData.emptyProps?(this.initPopupWindow(),this.obPopupWin.setTitleBar(BX.message("TITLE_BASKET_PROPS")),BX(this.visual.BASKET_PROP_DIV)&&(e=BX(this.visual.BASKET_PROP_DIV).innerHTML),this.obPopupWin.setContent(e),this.obPopupWin.setButtons([new i({text:BX.message("BTN_MESSAGE_SEND_PROPS"),events:{click:BX.delegate(this.sendToBasket,this)}})]),this.obPopupWin.show()):this.sendToBasket();break;case 0:case 3:this.sendToBasket()}},basketResult:function(t){var s,e="",a=[];if(this.obPopupWin&&this.obPopupWin.close(),BX.type.isPlainObject(t))if((s="OK"===t.STATUS)&&this.setAnalyticsDataLayer("addToCart"),s&&"BUY"===this.basketAction)this.basketRedirect();else if(s){switch(this.productType){case 3:Basket.inbasket(this.offers[this.offerNum].ID,!1);break;default:Basket.inbasket(this.product.id,!1)}BX.onCustomEvent("OnBasketChange",[{},"ADD2CART"]),BX.findParent(this.obProduct,{className:"bx_sale_gift_main_products"},10)&&BX.onCustomEvent("onAddToBasketMainProduct",[this])}else this.initPopupWindow(),e='<div style="width: 100%; margin: 0; text-align: center;"><p>'+(t.MESSAGE?t.MESSAGE:BX.message("BASKET_UNKNOWN_ERROR"))+"</p></div>",a=[new i({text:BX.message("BTN_MESSAGE_CLOSE"),events:{click:BX.delegate(this.obPopupWin.close,this.obPopupWin)}})],this.obPopupWin.setTitleBar(s?BX.message("TITLE_SUCCESSFUL"):BX.message("TITLE_ERROR")),this.obPopupWin.setContent(e),this.obPopupWin.setButtons(a),this.obPopupWin.show()},basketRedirect:function(){location.href=this.basketData.basketUrl?this.basketData.basketUrl:BX.message("BASKET_URL")},initPopupWindow:function(){this.obPopupWin||(this.obPopupWin=BX.PopupWindowManager.create("CatalogSectionBasket_"+this.visual.ID,null,{autoHide:!0,offsetLeft:0,offsetTop:0,overlay:!0,closeByEsc:!0,titleBar:!0,closeIcon:!0,contentColor:"white",className:this.templateTheme?"bx-"+this.templateTheme:""}))},setOfferCurrentValue:function(t,i){var s=this.getEntities(t,"sku-current-value");for(var e in s)s.hasOwnProperty(e)&&BX.type.isDomNode(s[e])&&(s[e].innerHTML=i.getAttribute("title"))},setCartStatus:function(){if(this.obBasketActions&&null!=t.Basket){var i,s=Basket.inbasket();switch(this.productType){case 3:i=this.offers[this.offerNum].ID;break;default:i=this.product.id}BX.util.in_array(i,s)?(BX.addClass(this.obBasketActions,"is-incart"),this.obBuyBtn&&(this.obBuyBtn.innerHTML=this.mess.MESS_BTN_INCART)):(BX.removeClass(this.obBasketActions,"is-incart"),this.obBuyBtn&&(this.obBuyBtn.innerHTML=this.mess.MESS_BTN_BUY))}},getEntities:function(t,i,s){return t&&i?(s=s||"",t.querySelectorAll(s+'[data-entity="'+i+'"]')):{length:0}},favorite:function(t){BX.PreventDefault(t),RS.Favorite.request(this.product.id)},checkFavorite:function(){if(this.obFavorite){var t=this.obFavorite.querySelector('[data-entity="favorite-title"]');BX.util.in_array(this.product.id,RS.Favorite.getItems())?(BX.addClass(this.obFavorite,"checked"),t&&(t.innerHTML=BX.message("BTN_FAVORITE_DEL"))):(BX.removeClass(this.obFavorite,"checked"),t&&(t.innerHTML=BX.message("BTN_FAVORITE_ADD")))}},showProductPreview:function(t){BX.PreventDefault(t),alert("showProductPreview")},setProductDeal:function(t){if(this.obProductDeal){var i=this.offers[t];if(void 0===i.PRODUCT_DEAL||null===i.PRODUCT_DEAL)BX.adjust(this.obProductDeal,{style:{display:"none"}});else{BX.adjust(this.obProductDeal,{style:{display:""}});var s=this.obProductDeal.querySelector('[data-entity="product-deal-name"]');s&&BX.adjust(s,{html:i.PRODUCT_DEAL.NAME})}}}}}}(window);